(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[547],{494:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mapp",function(){return n(3157)}])},9597:function(e,t,n){"use strict";n.d(t,{g:function(){return s}});var r=n(5893);function s(){return(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center ",children:(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-8 w-8 text-sky-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}},3157:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var r=n(5893),s=(n(1379),n(7568)),a=n(6042),u=n(4051),c=n.n(u),o=n(2842),i=n.n(o),l=n(9499),p=n(3454),d=(0,l.Z)({clientId:p.env.KEYCLOAK_ID,clientSecret:p.env.KEYCLOAK_SECRET,issuer:p.env.KEYCLOAK_ISSUER,name:"Steedos ID"}),f=n(4931),m=n(6486),h=n(2474),v=n.n(h),x=(0,f.Z)({name:"Password",credentials:{username:{label:"Username",type:"text",placeholder:""},password:{label:"Password",type:"password"},domain:{label:"Domain",type:"text"}},authorize:function(e,t){return(0,s.Z)(c().mark((function t(){var n,r,s,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=null,t.prev=1,r=e.domain,(0,m.endsWith)(r,"/")&&(r=r.substring(0,r.length-1)),t.next=6,fetch("".concat(r,"/accounts/password/login"),{method:"POST",body:JSON.stringify({user:{email:e.email},password:v().createHash("sha256").update(e.password).digest("hex")})});case 6:return s=t.sent,t.next=9,s.json();case 9:if((a=t.sent).user){t.next=12;break}return t.abrupt("return",null);case 12:n={id:a.user.id,name:a.user.name,local:a.user.local,email:a.user.email,utcOffset:a.user.utcOffset,steedos:{space:a.space,token:a.token,userId:a.user.id,name:a.user.name}},t.next=18;break;case 15:t.prev=15,t.t0=t.catch(1),console.log(t.t0);case 18:if(!n){t.next=22;break}return t.abrupt("return",n);case 22:return t.abrupt("return",null);case 23:case"end":return t.stop()}}),t,null,[[1,15]])})))()}}),w=n(3454),k=n(9669),E=n(9960),b=w.env.STEEDOS_ROOT_URL,_={},T={},g=function(e){var t={iss:w.env.NEXTAUTH_URL,sub:"steedos-nextjs-amis",profile:(0,a.Z)({email:e.email},e)};return E.sign(t,w.env.STEEDOS_IDENTITY_JWT_SECRET,{expiresIn:60})},O=function(){var e=(0,s.Z)(c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_[t.email]){e.next=2;break}return e.abrupt("return",_[t.email]);case 2:return n=b,e.next=5,k({url:"".concat(n).concat("/accounts/jwt/login"),method:"get",data:{},headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(g(t))}});case 5:return r=e.sent,_[t.email]=r.data,e.abrupt("return",_[t.email]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,s.Z)(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!T[t.email]){e.next=2;break}return e.abrupt("return",T[t.email]);case 2:return e.next=4,k({url:"".concat(b).concat("/api/setup/validate"),method:"post",data:{},headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.space,",").concat(t.token)}});case 4:return n=e.sent,T[t.email]=n.data,e.abrupt("return",T[t.email]);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S={secret:w.env.NEXTAUTH_SECRET,providers:w.env.STEEDOS_IDENTITY_OIDC_ENABLED?[x,d]:[x],callbacks:{jwt:function(e){return(0,s.Z)(c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.token,e.account,(r=e.user)&&r.steedos&&(n.steedos=r.steedos),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})))()},session:function(e){var t=e.session,n=e.token;e.user;return(0,s.Z)(c().mark((function e(){var r,s,a,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.user){e.next=13;break}if(!n||!n.steedos){e.next=5;break}t.steedos=n.steedos,e.next=9;break;case 5:return e.next=7,O(t.user);case 7:(r=e.sent).space&&r.token&&(t.steedos={space:r.space,token:r.token,userId:null===(s=r.user)||void 0===s?void 0:s.id,name:null===(a=r.user)||void 0===a?void 0:a.name});case 9:return e.next=11,N(t.steedos);case 11:u=e.sent,t.steedos=Object.assign(u,{token:u.authToken});case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})))()}},pages:{signIn:"/login"}},y=(i()(S),n(7294)),C=n(1163),j=n(9597);function I(){var e=(0,C.useRouter)();return(0,y.useEffect)((function(){getApps().then((function(t){t&&t.length>0&&e.push(t[0].path)}))}),[]),(0,r.jsx)(j.g,{})}}},function(e){e.O(0,[714,764,657,774,888,179],(function(){return t=494,e(e.s=t);var t}));var t=e.O();_N_E=t}]);