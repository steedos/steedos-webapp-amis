(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{2137:function(e,s,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mapp/[app_id]/[tab_id]/grid/[listview_id]",function(){return i(682)}])},682:function(e,s,i){"use strict";i.r(s),i.d(s,{__N_SSP:function(){return _},default:function(){return j}});var a=i(5893),t=(i(5152),i(6859),i(7294)),n=i(1163),l=i(6195),d=i(3796),o=i(5083),r=i(8876),c=i(1355),u=i(471),m=i(1013),v=i(8057),h=i(6486),p=i(2767),f=i(8930),x=i(4413);function g(e){var s,i,l,d,o,g=e.schema,_=e.onListviewChange,j=e.formFactor,w=(0,t.useState)(null),N=w[0],b=w[1],y=(0,t.useState)(!1),S=(y[0],y[1],(0,t.useState)()),I=S[0],k=S[1],R=(0,t.useState)(),F=R[0],U=R[1],L=(0,n.useRouter)(),C=L.query,E=C.app_id,T=C.tab_id,V=C.listview_id,A=g.uiSchema.list_views[V],B=SteedosUI.getRefId({type:"listview",appId:E,name:null===g||void 0===g||null===(s=g.uiSchema)||void 0===s?void 0:s.name});(0,t.useEffect)((function(){g&&(g&&g.uiSchema&&b((0,x.Iv)(g.uiSchema,{app_id:E,tab_id:T,router:L})),window.addEventListener("message",(function(e){"listview.loaded"===e.data.type&&g&&setTimeout((function(){if(SteedosUI.getRef(B)&&SteedosUI.getRef(B).getComponentByName){var e=SteedosUI.getRef(B).getComponentByName("page.listview_".concat(g.uiSchema.name));k({count:e.props.data.count,dataUpdatedAt:e.props.dataUpdatedAt})}}),300)})))}),[g]);var O=function(e){SteedosUI.getRef(B).getComponentByName("page.listview_".concat(g.uiSchema.name)).handleAction({},{actionType:"reload"})};(0,t.useEffect)((function(){!(0,h.isEmpty)(V)&&(0,h.isFunction)(_)&&(U(null),_(A))}),[V]);var P=[{label:"\u65b0\u5efa",name:"new",todo:function(e){var s,i=SteedosUI.getRefId({type:"listview",appId:E,name:null===g||void 0===g||null===(s=g.uiSchema)||void 0===s?void 0:s.name});x.QU.standard_new.call({},e,{listViewId:i,appId:E,uiSchema:g.uiSchema,formFactor:j,router:L,options:{props:{width:"100%",style:{width:"100%"},bodyStyle:{padding:"0px",paddingTop:"0px"}}}})}}];return(0,a.jsx)("div",{className:"slds-page-header relative rounded-none",children:(0,a.jsxs)("div",{className:"slds-page-header__row",children:[(0,a.jsx)("div",{className:"slds-page-header__col-title",children:(0,a.jsxs)("div",{className:"slds-media",children:[(0,a.jsx)("div",{className:"slds-media__figure",children:(0,a.jsx)("span",{className:"slds-icon_container slds-icon-standard-opportunity",children:(0,a.jsx)("svg",{className:"slds-icon slds-page-header__icon","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/standard-sprite/svg/symbols.svg#".concat(g.uiSchema.icon)})})})}),(0,a.jsx)("div",{className:"slds-media__body",children:(0,a.jsx)("div",{className:"slds-page-header__name",children:(0,a.jsx)("div",{className:"slds-page-header__name-title",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(r.R,{value:A,onChange:function(e){L.push(SteedosUI.Router.getObjectListViewPath({formFactor:j,appId:E,objectName:T,listViewName:e.name}))},children:(0,a.jsxs)("div",{className:"relative w-[1/2]",children:[(0,a.jsxs)(r.R.Button,{className:"relative w-full cursor-default pr-10 text-left focus:outline-none focus-visible:border-indigo-500 focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 focus-visible:ring-offset-2 focus-visible:ring-offset-orange-300 sm:text-sm",children:[(0,a.jsx)("span",{className:"slds-page-header__title slds-truncate",children:(null===A||void 0===A?void 0:A.label)||(null===(l=null===g||void 0===g||null===(i=g.uiSchema)||void 0===i?void 0:i.list_views.all)||void 0===l?void 0:l.label)}),(0,a.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,a.jsx)(m.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,a.jsx)(c.u,{as:t.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)(r.R.Options,{className:"absolute z-50 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:(0,h.values)(null===g||void 0===g||null===(d=g.uiSchema)||void 0===d?void 0:d.list_views).map((function(e,s){return(0,a.jsxs)(r.R.Option,{value:e,className:function(e){var s=e.active;return"relative cursor-default select-none py-2 pl-10 pr-4 ".concat(s?"bg-sky-50 text-sky-900":"text-gray-900")},children:[(0,a.jsx)("span",{className:"block truncate ".concat(((null===A||void 0===A?void 0:A.name)?A.name:"all")===e.name?"font-medium":"font-normal"),children:e.label}),((null===A||void 0===A?void 0:A.name)?A.name:"all")===e.name?(0,a.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-sky-600",children:(0,a.jsx)(v.Z,{className:"h-5 w-5","aria-hidden":"true"})}):null]},s)}))})})]})}),I&&(0,a.jsxs)("p",{className:"slds-page-header__meta-text mb-0",children:[I.count," \u9879 \u2022"," ",(0,a.jsx)(f.L,{date:I.dataUpdatedAt})]})]})})})})]})}),(0,a.jsx)("div",{className:"slds-page-header__col-actions",children:(0,a.jsxs)("div",{className:"slds-page-header__controls space-x-4",children:[(0,a.jsx)("div",{className:"slds-page-header__control",children:(0,a.jsxs)("button",{className:"slds-icon slds-icon-text-default slds-icon_x-small",title:"Refresh List",onClick:O,children:[(0,a.jsx)("svg",{className:"slds-button__icon","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#refresh"})}),(0,a.jsx)("span",{className:"slds-assistive-text",children:"Refresh List"})]})}),(0,a.jsx)("div",{className:"slds-page-header__control",children:(0,a.jsx)("ul",{className:"slds-button-group-list mb-0",children:(0,a.jsx)("li",{children:(0,a.jsxs)("button",{className:"slds-icon slds-icon-text-default slds-icon_x-small",onClick:function(){SteedosUI.ListView.showFilter(g.uiSchema.name,{listView:A,data:{filters:SteedosUI.ListView.getVisibleFilter(A,F)},props:{width:"100%",style:{width:"100%"}},onFilterChange:function(e){SteedosUI.getRef(B).updateProps({data:(0,h.defaultsDeep)({filter:SteedosUI.ListView.getQueryFilter(A,e)},g.amisSchema.data)},(function(){O(),U(e)})),setTimeout((function(){O(),U(e)}),300)}})},children:[(0,a.jsx)("svg",{className:"slds-button__icon","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#filterList"})}),(0,a.jsx)("span",{className:"slds-assistive-text",children:"\u8fc7\u6ee4\u5668"}),!(0,h.isEmpty)(F)&&(0,a.jsx)("span",{className:"slds-notification-badge slds-incoming-notification slds-show-notification min-h-[0.5rem] min-w-[0.5rem]"})]})})})}),(0,a.jsxs)(u.v,{as:"div",className:"slds-dropdown-trigger slds-dropdown-trigger_click",children:[(0,a.jsx)("div",{children:(0,a.jsx)(u.v.Button,{className:"border-0",children:(0,a.jsx)("div",{children:(0,a.jsx)("svg",{className:"slds-icon slds-icon-text-default slds-icon_x-small","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#threedots_vertical"})})})})}),(0,a.jsx)(c.u,{as:t.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsx)(u.v.Items,{className:"absolute right-0 z-10 mt-1 w-56 origin-top-right divide-y divide-gray-100 bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:rounded-[2px]",children:(0,a.jsx)("div",{className:"",children:null===(o=(0,h.concat)(P,N))||void 0===o?void 0:o.map((function(e,s){return(0,a.jsx)(u.v.Item,{children:function(s){var i=s.active;return(0,a.jsx)(p.z,{button:e,inMore:!0,data:{app_id:E,tab_id:T,object_name:g.uiSchema.name},className:"".concat(i?"bg-violet-500 text-white":"text-gray-900"," slds-dropdown__item group flex w-full items-center border-0 px-2 py-2")})}},s)}))})})})]})]})})]})})}var _=!0;function j(e){var s,i=e.formFactor,r=(0,n.useRouter)(),c=r.query,u=c.app_id,m=c.tab_id,v=(0,t.useState)(),h=v[0],p=v[1],f=SteedosUI.getRefId({type:"listview",appId:u,name:null===h||void 0===h||null===(s=h.uiSchema)||void 0===s?void 0:s.name}),x=function(e){(0,l.$R)(u,m,e,{formFactor:i}).then((function(e){p(e)}))};(0,t.useEffect)((function(){m&&i&&x(void 0)}),[m,i]);var _="SMALL"===i?g:o.z;return(0,a.jsxs)("div",{className:"slds-card slds-card_boundary slds-grid slds-grid--vertical shadow-none border-none",children:[(0,a.jsx)("div",{className:"",children:i&&(null===h||void 0===h?void 0:h.uiSchema.name)===m&&(0,a.jsx)(_,{schema:h,onListviewChange:function(e){x(null===e||void 0===e?void 0:e.name)},formFactor:i})}),(0,a.jsx)("div",{className:"",children:(null===h||void 0===h?void 0:h.amisSchema)&&(null===h||void 0===h?void 0:h.uiSchema.name)===m&&(0,a.jsx)(d.k,{className:"steedos-listview",id:f,schema:(null===h||void 0===h?void 0:h.amisSchema)||{},router:r})})]})}}},function(e){e.O(0,[764,499,83,774,888,179],(function(){return s=2137,e(e.s=s);var s}));var s=e.O();_N_E=s}]);