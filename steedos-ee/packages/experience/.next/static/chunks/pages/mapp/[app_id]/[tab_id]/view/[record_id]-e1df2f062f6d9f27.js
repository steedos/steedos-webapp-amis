(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[303],{2916:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mapp/[app_id]/[tab_id]/view/[record_id]",function(){return n(625)}])},8930:function(e,s,n){"use strict";n.d(s,{L:function(){return t}});var a=n(5893),r=n(7294);function t(e){var s=e.date,n=(0,r.useState)(),t=n[0],i=n[1],c=(0,r.useState)(""),d=c[0],l=c[1],o=function(e){return amisRequire("moment")(e).fromNow()};return(0,r.useEffect)((function(){t&&clearInterval(t),l(o(s)),i(setInterval((function(){l(o(s))}),6e4))}),[s]),(0,a.jsx)(a.Fragment,{children:d})}},625:function(e,s,n){"use strict";n.r(s),n.d(s,{__N_SSP:function(){return b},default:function(){return N}});var a=n(5893),r=(n(5152),n(6859),n(7294)),t=n(1163),i=n(6195),c=n(3796),d=n(9808),l=n(2917),o=n(8985),u=n(6042),m=n(9396),f=n(1664),h=n.n(f),_=(n(8930),n(5125),n(6486),n(4588)),x=function(e){var s,n=e.schema,r=e.object_name,t=e.foreign_key,i=e.app_id,c=e.record_id,d=e.masterObjectName,l=e.recordCount,o=e.formFactor;return(0,a.jsx)(h(),{href:_.h.Router.getObjectRelatedViewPath({formFactor:o,appId:i,masterObjectName:d,masterRecordId:c,objectName:r,foreignKey:t}),children:(0,a.jsxs)("div",{className:"slds-grid slds-page-header rounded-none p-2 bg-white border-0 shadow-none",children:[(0,a.jsxs)("header",{className:"slds-media slds-media--center slds-has-flexi-truncate",children:[(0,a.jsx)("div",{"aria-hidden":"true",className:"slds-media__figure stencil slds-avatar slds-avatar_small",children:(0,a.jsx)("div",{className:"extraSmall forceEntityIcon",children:(0,a.jsx)("span",{className:"uiImage slds-icon_container slds-icon-standard-".concat(null===(s=n.uiSchema.icon)||void 0===s?void 0:s.replaceAll("_","-")),children:(0,a.jsx)("svg",{className:"slds-icon slds-page-header__icon","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/standard-sprite/svg/symbols.svg#".concat(n.uiSchema.icon)})})})})}),(0,a.jsx)("div",{className:"slds-media__body",children:(0,a.jsx)("h2",{className:"slds-card__header-title",children:(0,a.jsx)("a",{className:"slds-card__header-link baseCard__header-title-container font-normal",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"slds-truncate slds-m-right--xx-small",children:n.uiSchema.label}),(0,a.jsxs)("span",{className:"slds-shrink-none slds-m-right--xx-small",children:["(",l,")"]})]})})})})]}),(0,a.jsx)("div",{className:"slds-no-flex",children:(0,a.jsx)("span",{className:"slds-icon_container null slds-icon__svg--default",children:(0,a.jsx)("svg",{className:"slds-icon slds-icon-text-default slds-icon_x-small","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#chevronright"})})})})]})})},p=n(237),v=function(e){var s=e.app_id,n=e.record_id,t=e.relateds,i=e.formFactor,c=(0,r.useState)({}),d=c[0],l=c[1];return(0,r.useEffect)((function(){(0,p.r)(n,t).then((function(e){l(e)}))}),[n,t]),(0,a.jsx)("div",{className:"divide-y",children:null===t||void 0===t?void 0:t.map((function(e){return(0,a.jsx)(x,(0,m.Z)((0,u.Z)({},e),{app_id:s,record_id:n,formFactor:i,recordCount:d[e.object_name]}))}))})};function j(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return s.filter(Boolean).join(" ")}var b=!0;function N(e){var s=e.formFactor,n=(0,t.useRouter)(),u=n.query,m=u.app_id,f=u.tab_id,h=u.record_id,_=(0,r.useState)(!1),x=_[0],p=_[1],b=(0,r.useState)(null),N=b[0],g=b[1],w=(0,r.useState)(null),S=w[0],I=w[1],k=function(){s&&y(f,h,s)};(0,r.useEffect)((function(){k()}),[n]),(0,r.useEffect)((function(){x?s&&F(f,h,s):k()}),[s]);var y=function(e,s,n){if(e&&s){var a=(0,i.ke)(m,e,s,n),r=(0,i.DM)(e,s,{recordId:s,tabId:e,appId:m,formFactor:n});Promise.all([a,r]).then((function(e){I(e[0]);var s=e[1];g(s),p(!1)}))}},F=function(e,s,n){e&&s&&(0,i.KR)(e,{recordId:s,tabId:e,appId:m,formFactor:n}).then((function(e){g(e),p(!0)}))},E=function(){var e=[{label:"\u8be6\u60c5",name:"detail",component:function(){return(0,a.jsx)(a.Fragment,{children:(null===N||void 0===N?void 0:N.amisSchema)&&(0,a.jsx)(c.k,{id:SteedosUI.getRefId({type:"detail",appId:m,name:N.uiSchema.name}),schema:(null===N||void 0===N?void 0:N.amisSchema)||{},router:n})})}}];return S&&S.length>0&&e.push({label:"\u76f8\u5173",name:"relateds",component:function(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(v,{app_id:m,record_id:h,relateds:S,formFactor:s})})}}),e},O="SMALL"===s?o.b:l.b;return(0,a.jsxs)("div",{className:"slds-grid slds-wrap",children:[(0,a.jsx)("div",{className:"slds-col slds-size_1-of-1 row region-header bg-slate-50",children:N&&(0,a.jsx)(O,{schema:N,formFactor:s})}),(0,a.jsx)("div",{className:"slds-col slds-size_1-of-1 row region-main",children:(0,a.jsx)("div",{className:"z-9 relative shadow-none border-none",children:(0,a.jsxs)(d.O.Group,{vertical:!0,children:[(0,a.jsx)(d.O.List,{className:"pl-4 flex space-x-1 border-b bg-slate-50",children:E().map((function(e){return(0,a.jsx)(d.O,{className:function(e){return j("px-10",e.selected?"border-b-2 border-sky-500 text-black":"text-current")},children:e.label},e.name)}))}),(0,a.jsx)(d.O.Panels,{className:"flex-1 p-4 overflow-y-auto ",children:E().map((function(e){return(0,a.jsx)(d.O.Panel,{className:j("bg-white shadow-none","p-2"),children:e.component()},e.name)}))})]})})})]})}}},function(e){e.O(0,[764,499,449,774,888,179],(function(){return s=2916,e(e.s=s);var s}));var s=e.O();_N_E=s}]);