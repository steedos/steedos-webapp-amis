(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[303],{2916:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mapp/[app_id]/[tab_id]/view/[record_id]",function(){return s(8947)}])},8930:function(e,n,s){"use strict";s.d(n,{L:function(){return t}});var r=s(5893),a=s(7294);function t(e){var n=e.date,s=(0,a.useState)(),t=s[0],c=s[1],i=(0,a.useState)(""),d=i[0],o=i[1],l=function(e){return amisRequire("moment")(e).fromNow()};return(0,a.useEffect)((function(){t&&clearInterval(t),o(l(n)),c(setInterval((function(){o(l(n))}),6e4))}),[n]),(0,r.jsx)(r.Fragment,{children:d})}},8947:function(e,n,s){"use strict";s.r(n),s.d(n,{__N_SSP:function(){return y},default:function(){return I}});var r=s(5893),a=(s(5152),s(6859),s(7294)),t=s(1163),c=s(6195),i=s(3796),d=s(9808),o=s(2917),l=s(8985),u=s(6042),m=s(9396),f=s(1664),h=s.n(f),p=(s(8930),s(5125),s(6486)),_=s(4588),x=function(e){var n,s=e.schema,a=e.object_name,t=e.foreign_key,c=e.app_id,i=e.record_id,d=e.masterObjectName,o=e.recordCount,l=e.formFactor;return(0,r.jsx)(h(),{href:_.h.Router.getObjectRelatedViewPath({formFactor:l,appId:c,masterObjectName:d,masterRecordId:i,objectName:a,foreignKey:t}),children:(0,r.jsxs)("div",{className:"slds-grid slds-page-header rounded-none p-2 bg-white border-0 shadow-none",children:[(0,r.jsxs)("header",{className:"slds-media slds-media--center slds-has-flexi-truncate",children:[(0,r.jsx)("div",{"aria-hidden":"true",className:"slds-media__figure stencil slds-avatar slds-avatar_small",children:(0,r.jsx)("div",{className:"extraSmall forceEntityIcon",children:(0,r.jsx)("span",{className:"uiImage slds-icon_container slds-icon-standard-".concat(null===(n=s.uiSchema.icon)||void 0===n?void 0:n.replaceAll("_","-")),children:(0,r.jsx)("svg",{className:"slds-icon slds-page-header__icon","aria-hidden":"true",children:(0,r.jsx)("use",{xlinkHref:"/assets/icons/standard-sprite/svg/symbols.svg#".concat(s.uiSchema.icon)})})})})}),(0,r.jsx)("div",{className:"slds-media__body",children:(0,r.jsx)("h2",{className:"slds-card__header-title",children:(0,r.jsx)("a",{className:"slds-card__header-link baseCard__header-title-container font-normal",children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"slds-truncate slds-m-right--xx-small",children:s.uiSchema.label}),(0,r.jsxs)("span",{className:"slds-shrink-none slds-m-right--xx-small",children:["(",o,")"]})]})})})})]}),(0,r.jsx)("div",{className:"slds-no-flex",children:(0,r.jsx)("span",{className:"slds-icon_container null slds-icon__svg--default",children:(0,r.jsx)("svg",{className:"slds-icon slds-icon-text-default slds-icon_x-small","aria-hidden":"true",children:(0,r.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#chevronright"})})})})]})})},v=s(7568),j=s(4051),b=s.n(j),g=s(8282),N=function(){var e=(0,v.Z)(b().mark((function e(n,s){var r,a,t;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],(0,p.each)(s,(function(e){r.push("".concat(e.object_name,": ").concat(e.object_name,'__count(filters: [["').concat(e.foreign_key,'","=","').concat(n,'"]])'))})),a="\n    {\n        ".concat(r.join(","),"\n    }\n    "),e.next=5,(0,g.Io)("/graphql",{method:"POST",body:JSON.stringify({query:a})});case 5:return t=e.sent,e.abrupt("return",t.data);case 7:case"end":return e.stop()}}),e)})));return function(n,s){return e.apply(this,arguments)}}(),w=function(e){var n=e.app_id,s=e.record_id,t=e.relateds,c=e.formFactor,i=(0,a.useState)({}),d=i[0],o=i[1];return(0,a.useEffect)((function(){N(s,t).then((function(e){o(e)}))}),[s,t]),(0,r.jsx)("div",{className:"divide-y",children:null===t||void 0===t?void 0:t.map((function(e){return(0,r.jsx)(x,(0,m.Z)((0,u.Z)({},e),{app_id:n,record_id:s,formFactor:c,recordCount:d[e.object_name]}))}))})};function S(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return n.filter(Boolean).join(" ")}var y=!0;function I(e){var n=e.formFactor,s=(0,t.useRouter)(),u=s.query,m=u.app_id,f=u.tab_id,h=u.record_id,p=(0,a.useState)(!1),_=p[0],x=p[1],v=(0,a.useState)(null),j=v[0],b=v[1],g=(0,a.useState)(null),N=g[0],y=g[1],I=function(){n&&k(f,h,n)};(0,a.useEffect)((function(){I()}),[s]),(0,a.useEffect)((function(){_?n&&F(f,h,n):I()}),[n]);var k=function(e,n,s){if(e&&n){var r=(0,c.ke)(m,e,n,s),a=(0,c.DM)(e,n,{recordId:n,tabId:e,appId:m,formFactor:s});Promise.all([r,a]).then((function(e){y(e[0]);var n=e[1];b(n),x(!1)}))}},F=function(e,n,s){e&&n&&(0,c.KR)(e,{recordId:n,tabId:e,appId:m,formFactor:s}).then((function(e){b(e),x(!0)}))},O=function(){var e=[{label:"\u8be6\u60c5",name:"detail",component:function(){return(0,r.jsx)(r.Fragment,{children:(null===j||void 0===j?void 0:j.amisSchema)&&(0,r.jsx)(i.k,{id:SteedosUI.getRefId({type:"detail",appId:m,name:j.uiSchema.name}),schema:(null===j||void 0===j?void 0:j.amisSchema)||{},router:s})})}}];return N&&N.length>0&&e.push({label:"\u76f8\u5173",name:"relateds",component:function(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(w,{app_id:m,record_id:h,relateds:N,formFactor:n})})}}),e},E="SMALL"===n?l.b:o.b;return(0,r.jsxs)("div",{className:"slds-grid slds-wrap",children:[(0,r.jsx)("div",{className:"slds-col slds-size_1-of-1 row region-header bg-slate-50",children:j&&(0,r.jsx)(E,{schema:j,formFactor:n})}),(0,r.jsx)("div",{className:"slds-col slds-size_1-of-1 row region-main",children:(0,r.jsx)("div",{className:"z-9 relative shadow-none border-none",children:(0,r.jsxs)(d.O.Group,{vertical:!0,children:[(0,r.jsx)(d.O.List,{className:"pl-4 flex space-x-1 border-b bg-slate-50",children:O().map((function(e){return(0,r.jsx)(d.O,{className:function(e){return S("px-10",e.selected?"border-b-2 border-sky-500 text-black":"text-current")},children:e.label},e.name)}))}),(0,r.jsx)(d.O.Panels,{className:"flex-1 p-4 overflow-y-auto ",children:O().map((function(e){return(0,r.jsx)(d.O.Panel,{className:S("bg-white shadow-none","p-2"),children:e.component()},e.name)}))})]})})})]})}}},function(e){e.O(0,[499,363,774,888,179],(function(){return n=2916,e(e.s=n);var n}));var n=e.O();_N_E=n}]);