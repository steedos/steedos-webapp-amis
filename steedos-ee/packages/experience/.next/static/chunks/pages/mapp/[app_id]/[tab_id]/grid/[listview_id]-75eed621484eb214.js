(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{2137:function(e,s,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mapp/[app_id]/[tab_id]/grid/[listview_id]",function(){return i(682)}])},682:function(e,s,i){"use strict";i.r(s),i.d(s,{__N_SSP:function(){return j},default:function(){return w}});var a=i(5893),t=(i(5152),i(6859),i(7294)),n=i(1163),l=i(6195),o=i(3796),d=i(5083),c=i(8876),r=i(1355),u=i(471),m=i(1013),v=i(8057),h=i(6486),p=i(2767),f=i(8930),g=i(7733),x=i(4413);function _(e){var s,i,l,o,d,_=e.schema,j=e.onListviewChange,w=e.formFactor,b=(0,t.useState)(null),N=b[0],y=b[1],S=(0,t.useState)(!1),I=(S[0],S[1],(0,t.useState)()),R=I[0],U=I[1],k=(0,t.useState)(),F=k[0],C=k[1],L=(0,n.useRouter)(),E=L.query,T=E.app_id,V=E.tab_id,A=E.listview_id,B=_.uiSchema.list_views[A],O=SteedosUI.getRefId({type:"listview",appId:T,name:null===_||void 0===_||null===(s=_.uiSchema)||void 0===s?void 0:s.name});(0,t.useEffect)((function(){_&&(_&&_.uiSchema&&y((0,x.Iv)(_.uiSchema,{app_id:T,tab_id:V,router:L})),window.addEventListener("message",(function(e){"listview.loaded"===e.data.type&&_&&setTimeout((function(){if(SteedosUI.getRef(O)&&SteedosUI.getRef(O).getComponentByName){var e=SteedosUI.getRef(O).getComponentByName("page.listview_".concat(_.uiSchema.name));U({count:e.props.data.count,dataUpdatedAt:e.props.dataUpdatedAt})}}),300)})))}),[_]);var P=function(e){SteedosUI.getRef(O).getComponentByName("page.listview_".concat(_.uiSchema.name)).handleAction({},{actionType:"reload"})};(0,t.useEffect)((function(){!(0,h.isEmpty)(A)&&(0,h.isFunction)(j)&&(C(null),j(B))}),[A]);var z=[{label:"\u65b0\u5efa",name:"new",todo:function(){var e,s=SteedosUI.getRefId({type:"listview",appId:T,name:null===_||void 0===_||null===(e=_.uiSchema)||void 0===e?void 0:e.name}),i=g.Z.listView.newRecordMode;SteedosUI.Object.newRecord({onSubmitted:function(){SteedosUI.getRef(s).getComponentByName("page.listview_".concat(_.uiSchema.name)).handleAction({},{actionType:"reload"})},onCancel:function(){SteedosUI.getRef(s).getComponentByName("page.listview_".concat(_.uiSchema.name)).handleAction({},{actionType:"reload"})},appId:T,name:SteedosUI.getRefId({type:"".concat(i,"-form")}),title:"\u65b0\u5efa ".concat(_.uiSchema.label),objectName:_.uiSchema.name,recordId:"new",formFactor:w,type:i,options:{props:{width:"100%",style:{width:"100%"},bodyStyle:{padding:"0px",paddingTop:"0px"}}},router:L})}}];return(0,a.jsx)("div",{className:"slds-page-header relative rounded-none",children:(0,a.jsxs)("div",{className:"slds-page-header__row",children:[(0,a.jsx)("div",{className:"slds-page-header__col-title",children:(0,a.jsxs)("div",{className:"slds-media",children:[(0,a.jsx)("div",{className:"slds-media__figure",children:(0,a.jsx)("span",{className:"slds-icon_container slds-icon-standard-opportunity",children:(0,a.jsx)("svg",{className:"slds-icon slds-page-header__icon","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/standard-sprite/svg/symbols.svg#".concat(_.uiSchema.icon)})})})}),(0,a.jsx)("div",{className:"slds-media__body",children:(0,a.jsx)("div",{className:"slds-page-header__name",children:(0,a.jsx)("div",{className:"slds-page-header__name-title",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(c.R,{value:B,onChange:function(e){L.push(SteedosUI.Router.getObjectListViewPath({formFactor:w,appId:T,objectName:V,listViewName:e.name}))},children:(0,a.jsxs)("div",{className:"relative w-[1/2]",children:[(0,a.jsxs)(c.R.Button,{className:"relative w-full cursor-default pr-10 text-left focus:outline-none focus-visible:border-indigo-500 focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 focus-visible:ring-offset-2 focus-visible:ring-offset-orange-300 sm:text-sm",children:[(0,a.jsx)("span",{className:"slds-page-header__title slds-truncate",children:(null===B||void 0===B?void 0:B.label)||(null===(l=null===_||void 0===_||null===(i=_.uiSchema)||void 0===i?void 0:i.list_views.all)||void 0===l?void 0:l.label)}),(0,a.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,a.jsx)(m.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,a.jsx)(r.u,{as:t.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)(c.R.Options,{className:"absolute z-50 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:(0,h.values)(null===_||void 0===_||null===(o=_.uiSchema)||void 0===o?void 0:o.list_views).map((function(e,s){return(0,a.jsxs)(c.R.Option,{value:e,className:function(e){var s=e.active;return"relative cursor-default select-none py-2 pl-10 pr-4 ".concat(s?"bg-sky-50 text-sky-900":"text-gray-900")},children:[(0,a.jsx)("span",{className:"block truncate ".concat(((null===B||void 0===B?void 0:B.name)?B.name:"all")===e.name?"font-medium":"font-normal"),children:e.label}),((null===B||void 0===B?void 0:B.name)?B.name:"all")===e.name?(0,a.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-sky-600",children:(0,a.jsx)(v.Z,{className:"h-5 w-5","aria-hidden":"true"})}):null]},s)}))})})]})}),R&&(0,a.jsxs)("p",{className:"slds-page-header__meta-text mb-0",children:[R.count," \u9879 \u2022"," ",(0,a.jsx)(f.L,{date:R.dataUpdatedAt})]})]})})})})]})}),(0,a.jsx)("div",{className:"slds-page-header__col-actions",children:(0,a.jsxs)("div",{className:"slds-page-header__controls space-x-4",children:[(0,a.jsx)("div",{className:"slds-page-header__control",children:(0,a.jsxs)("button",{className:"slds-icon slds-icon-text-default slds-icon_x-small",title:"Refresh List",onClick:P,children:[(0,a.jsx)("svg",{className:"slds-button__icon","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#refresh"})}),(0,a.jsx)("span",{className:"slds-assistive-text",children:"Refresh List"})]})}),(0,a.jsx)("div",{className:"slds-page-header__control",children:(0,a.jsx)("ul",{className:"slds-button-group-list mb-0",children:(0,a.jsx)("li",{children:(0,a.jsxs)("button",{className:"slds-icon slds-icon-text-default slds-icon_x-small",onClick:function(){SteedosUI.ListView.showFilter(_.uiSchema.name,{listView:B,data:{filters:SteedosUI.ListView.getVisibleFilter(B,F)},props:{width:"100%",style:{width:"100%"}},onFilterChange:function(e){SteedosUI.getRef(O).updateProps({data:(0,h.defaultsDeep)({filter:SteedosUI.ListView.getQueryFilter(B,e)},_.amisSchema.data)},(function(){P(),C(e)})),setTimeout((function(){P(),C(e)}),300)}})},children:[(0,a.jsx)("svg",{className:"slds-button__icon","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#filterList"})}),(0,a.jsx)("span",{className:"slds-assistive-text",children:"\u8fc7\u6ee4\u5668"}),!(0,h.isEmpty)(F)&&(0,a.jsx)("span",{className:"slds-notification-badge slds-incoming-notification slds-show-notification min-h-[0.5rem] min-w-[0.5rem]"})]})})})}),(0,a.jsxs)(u.v,{as:"div",className:"slds-dropdown-trigger slds-dropdown-trigger_click",children:[(0,a.jsx)("div",{children:(0,a.jsx)(u.v.Button,{className:"border-0",children:(0,a.jsx)("div",{children:(0,a.jsx)("svg",{className:"slds-icon slds-icon-text-default slds-icon_x-small","aria-hidden":"true",children:(0,a.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#threedots_vertical"})})})})}),(0,a.jsx)(r.u,{as:t.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsx)(u.v.Items,{className:"absolute right-0 z-10 mt-1 w-56 origin-top-right divide-y divide-gray-100 bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:rounded-[2px]",children:(0,a.jsx)("div",{className:"",children:null===(d=(0,h.concat)(z,N))||void 0===d?void 0:d.map((function(e,s){return(0,a.jsx)(u.v.Item,{children:function(s){var i=s.active;return(0,a.jsx)(p.z,{button:e,inMore:!0,data:{app_id:T,tab_id:V,object_name:_.uiSchema.name},className:"".concat(i?"bg-violet-500 text-white":"text-gray-900"," slds-dropdown__item group flex w-full items-center border-0 px-2 py-2")})}},s)}))})})})]})]})})]})})}var j=!0;function w(e){var s,i=e.formFactor,c=(0,n.useRouter)(),r=c.query,u=r.app_id,m=r.tab_id,v=(0,t.useState)(),h=v[0],p=v[1],f=SteedosUI.getRefId({type:"listview",appId:u,name:null===h||void 0===h||null===(s=h.uiSchema)||void 0===s?void 0:s.name}),g=function(e){(0,l.$R)(u,m,e,{formFactor:i}).then((function(e){p(e)}))};(0,t.useEffect)((function(){m&&i&&g(void 0)}),[m,i]);var x="SMALL"===i?_:d.z;return(0,a.jsxs)("div",{className:"slds-card slds-card_boundary slds-grid slds-grid--vertical shadow-none border-none",children:[(0,a.jsx)("div",{className:"",children:i&&(null===h||void 0===h?void 0:h.uiSchema.name)===m&&(0,a.jsx)(x,{schema:h,onListviewChange:function(e){g(null===e||void 0===e?void 0:e.name)},formFactor:i})}),(0,a.jsx)("div",{className:"",children:(null===h||void 0===h?void 0:h.amisSchema)&&(null===h||void 0===h?void 0:h.uiSchema.name)===m&&(0,a.jsx)(o.k,{className:"steedos-listview",id:f,schema:(null===h||void 0===h?void 0:h.amisSchema)||{},router:c})})]})}}},function(e){e.O(0,[764,499,83,774,888,179],(function(){return s=2137,e(e.s=s);var s}));var s=e.O();_N_E=s}]);