(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[408],{2578:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mapp/[app_id]/[tab_id]/[record_id]/[related_object_name]/grid",function(){return n(2605)}])},8930:function(e,t,n){"use strict";n.d(t,{L:function(){return r}});var a=n(5893),o=n(7294);function r(e){var t=e.date,n=(0,o.useState)(),r=n[0],s=n[1],i=(0,o.useState)(""),c=i[0],d=i[1],l=function(e){return amisRequire("moment")(e).fromNow()};return(0,o.useEffect)((function(){r&&clearInterval(r),d(l(t)),s(setInterval((function(){d(l(t))}),6e4))}),[t]),(0,a.jsx)(a.Fragment,{children:c})}},2767:function(e,t,n){"use strict";n.d(t,{z:function(){return c}});var a=n(6042),o=n(5893),r=n(3796),s=n(4413),i=n(1163);function c(e){var t=(0,i.useRouter)(),n=e.button,c=e.data,d=e.className,l=e.scopeClassName,u=e.inMore,m=c.dataComponentId;if("amis_action"===n.type){var p={type:"service",bodyClassName:"p-0",body:[{type:"button",label:n.label,className:"".concat(u?"flex w-full items-center border-0 px-2 py-1":"bg-white"," ").concat(d||""),onEvent:{click:{actions:JSON.parse(n.amis_actions)}}}],regions:["body"],data:(0,a.Z)({},c)};return(0,o.jsx)(r.k,{id:SteedosUI.getRefId({type:"button",appId:c.app_id,name:n.name}),schema:p,router:t,className:l})}return(0,o.jsx)("button",{onClick:function(){return(0,s.ht)(n,Object.assign({},c,{scope:SteedosUI.getRef(m)}))},className:"antd-Button antd-Button--default ".concat(d||""),children:n.label})}},5125:function(e,t,n){"use strict";n.d(t,{B:function(){return u}});var a=n(4924),o=n(5893),r=n(4413),s=n(1163),i=n(7294),c=n(2767),d=n(3796),l=n(8282);function u(e){var t,n,u=e.app_id,m=e.tab_id,p=e.schema,f=e.refId,_=e.foreign_key,h=e.record_id,b=e.object_name,g=e.masterObjectName,v=e.inMore,y=e.formFactor,x=(0,i.useState)(null),j=x[0],I=x[1],N=(0,s.useRouter)();(0,i.useEffect)((function(){p&&p.uiSchema&&I((0,r.Iv)(p.uiSchema,{app_id:u,tab_id:m,router:N}))}),[p]);var w=(0,l.Z0)(),S={type:"page",bodyClassName:"p-0",body:[{type:"form",title:"\u8868\u5355",body:[{type:"input-file",label:"",name:"file",id:"u:a58d02614e04",btnLabel:"\u4e0a\u4f20",btnClassName:"m-0",multiple:!1,maxLength:10,submitType:"asUpload",uploadType:"fileReceptor",proxy:!1,drag:!1,autoUpload:!0,useChunk:!1,joinValues:!1,extractValue:!1,valueField:"version_id",receiver:{url:"${context.rootUrl}/s3",headers:{Authorization:"Bearer ${context.tenantId},${context.authToken}"},method:"post",messages:{},dataType:"form-data",requestAdaptor:"\n                        api.data.append('record_id', '".concat(h,"');\n                        api.data.append('object_name', '").concat(g,"');\n                        api.data.append('space', '").concat(w.spaceId,"');\n                        api.data.append('owner', '").concat(w.userId,"');\n                        api.data.append('owner_name', '").concat(w.name,"');\n                        return api;\n                      ")},onEvent:{success:{weight:0,actions:[{componentId:"u:5f901c0b917b",args:{},actionType:"clear"},{componentId:"",args:{msgType:"success",position:"top-right",closeButton:!0,showIcon:!0,msg:"\u4e0a\u4f20\u6210\u529f"},actionType:"toast"},{componentId:"",args:{},actionType:"custom",script:"\n                                SteedosUI.getRef('".concat(f,"').getComponentByName('page.listview_").concat(b,'\').handleAction({}, { actionType: "reload"})\n                            ')}]}}}],id:"u:5f901c0b917b",wrapWithPanel:!1}],regions:["body"],data:{}};return(0,o.jsx)(o.Fragment,{children:(null===p||void 0===p?void 0:p.uiSchema)&&(0,o.jsxs)(o.Fragment,{children:[(null===p||void 0===p||null===(t=p.uiSchema)||void 0===t||null===(n=t.permissions)||void 0===n?void 0:n.allowCreate)&&(0,o.jsxs)(o.Fragment,{children:["cms_files"!=p.uiSchema.name&&(0,o.jsx)("button",{onClick:function(e){r.QU.standard_new.call({},e,{listViewId:f,appId:u,uiSchema:p.uiSchema,formFactor:y,router:N,data:{data:(0,a.Z)({},_,h)}})},className:v?"flex w-full items-center border-0 px-2 py-1":"slds-button slds-button_neutral",children:"\u65b0\u5efa"}),"cms_files"===p.uiSchema.name&&(0,o.jsx)(d.k,{id:SteedosUI.getRefId({type:"button",appId:u,name:"upload"}),schema:S,router:N,className:"inline-block"})]}),null===j||void 0===j?void 0:j.map((function(e){return(0,o.jsx)(c.z,{button:e,inMore:v,data:{app_id:u,tab_id:m,object_name:p.uiSchema.name,dataComponentId:SteedosUI.getRefId({type:"listview",appId:u,name:p.uiSchema.name})},className:v?"flex items-center border-0 px-2 py-1":"",scopeClassName:"inline-block"},e.name)}))]})})}},4413:function(e,t,n){"use strict";n.d(t,{ht:function(){return _},Iv:function(){return m},vU:function(){return p},ud:function(){return f},QU:function(){return l}});var a=n(6486),o=n.n(a),r="__G_L_O_B_A_L__",s=function(e){var t;return"string"===typeof e?1===(t=e.split(".")).length?"#":(t.pop(),t.join(".")):"#"},i=function(e,t){return"#"!==t&&t?"string"===typeof t?a.get(e,t):void console.error("path has to be a string"):e||{}},c=n(7733),d=function(e,t){if(e._visible&&(o().startsWith(o().trim(e._visible),"function")?(window.eval("var fun = "+e._visible),e.visible=fun):function(e){var t,n,a;return"string"===typeof e&&(t=/^{{(.+)}}$/,n=/^{{(function.+)}}$/,a=/^{{(.+=>.+)}}$/,!("string"!==typeof e||!e.match(t)||e.match(n)||e.match(a)))}(e._visible)&&(e.visible=function(t){!function(e,t,n,a){var o,c,d,l,u,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(void 0===t&&(t={}),l=s(n),d=i(t,l)||{},"string"!==typeof e)return e;c=e.substring(2,e.length-2),u="\n  var $user=".concat(JSON.stringify(m),";   return ")+c.replace(/\bformData\b/g,JSON.stringify(t).replace(/\bglobal\b/g,r)).replace(/\bglobal\b/g,JSON.stringify(a)).replace(new RegExp("\\b"+r+"\\b","g"),"global").replace(/rootValue/g,JSON.stringify(d));try{Function(u)()}catch(p){return o=p,console.log(o,e,n),e}}(e._visible,t.record,"#",{now:new Date},t.userSession)})),!o().isFunction(e.visible))return e.visible;try{return e.visible(t)}catch(n){}},l={standard_new:function(e,t){var n=t.appId,a=t.listViewId,o=t.uiSchema,r=t.formFactor,s=t.data,i=t.router,d=t.options,l=void 0===d?{}:d,u=c.Z.listView.newRecordMode;SteedosUI.Object.newRecord({onSubmitted:function(){SteedosUI.getRef(a).getComponentByName("page.listview_".concat(o.name)).handleAction({},{actionType:"reload"})},onCancel:function(){SteedosUI.getRef(a).getComponentByName("page.listview_".concat(o.name)).handleAction({},{actionType:"reload"})},appId:n,formFactor:r,name:SteedosUI.getRefId({type:"".concat(u,"-form")}),title:"\u65b0\u5efa ".concat(o.label),objectName:o.name,data:s,recordId:"new",type:u,options:l,router:i})},standard_edit:function(e,t){var n=c.Z.listView.newRecordMode,a=t.appId,o=t.recordId,r=t.uiSchema,s=t.formFactor,i=t.router,d=t.options,l=void 0===d?{}:d;SteedosUI.Object.editRecord({appId:a,name:SteedosUI.getRefId({type:"".concat(n,"-form")}),title:"\u7f16\u8f91 ".concat(r.label),objectName:r.name,recordId:o,type:n,options:l,router:i,formFactor:s,onSubmitted:function(){SteedosUI.getRef(SteedosUI.getRefId({type:"detail",appId:a,name:r.name})).getComponentById("detail_".concat(o)).reload()}})},standard_delete:function(e,t){},batch_delete:function(e,t){var n=t.listViewId,a=t.uiSchema,r=SteedosUI.getRef(n).getComponentByName("page.listview_".concat(a.name));o().isEmpty(r.props.store.toJSON().selectedItems)?r.handleAction({},{actionType:"toast",toast:{items:[{position:"top-right",body:"\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u9879"}]}}):r.handleBulkAction(r.props.store.toJSON().selectedItems,[],{},r.props.bulkActions[0])}},u=function(e,t){var n=e.permissions.disabled_actions,a=o().sortBy(o().values(e.actions),"sort");return o().has(e,"allow_customActions")&&(a=o().filter(a,(function(t){return o().include(e.allow_customActions,t.name)}))),o().has(e,"exclude_actions")&&(a=o().filter(a,(function(t){return!o().include(e.exclude_actions,t.name)}))),o().each(a,(function(e){t.isMobile&&["record","record_only"].indexOf(e.on)>-1&&"standard_edit"!=e.name&&("record_only"==e.on?e.on="record_only_more":e.on="record_more")})),t.isMobile&&["cms_files","cfs.files.filerecord"].indexOf(e.name)>-1&&o().map(a,(function(e){"standard_edit"===e.name&&(e.on="record_more"),"download"===e.name&&(e.on="record")})),o().filter(a,(function(e){return o().indexOf(n,e.name)<0}))},m=function(e,t){var n=u(e,t);return o().filter(n,(function(e){return"list"==e.on&&d(e,t)}))},p=function(e,t){var n=u(e,t);return o().filter(n,(function(e){return("record"==e.on||"record_only"==e.on)&&d(e,t)}))},f=function(e,t){var n=u(e,t);return o().filter(n,(function(e){return("record_more"==e.on||"record_only_more"==e.on)&&d(e,t)}))},_=function(e,t){if(e.todo)return o().isString(e.todo)&&o().startsWith(o().trim(e.todo),"function")&&(window.eval("var fun = "+e.todo),e.todo=fun),o().isFunction(e.todo)?e.todo.apply({},[t]):void 0}},2605:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var a=n(6042),o=n(9396),r=n(1351),s=n(5893),i=n(7294),c=n(6195),d=n(3796),l=n(1163),u=n(1664),m=n.n(u),p=n(8930),f=n(5125),h=n(471),b=n(1355),g=function(e){var t,n,a,o=e.app_id,r=e.foreign_key,c=e.masterObjectName,d=e.object_name,l=e.record_id,u=e.schema,g=e.record,v=e.masterObjectUISchema,y=e.formFactor,x=(0,i.useState)(),j=x[0],I=x[1],N=SteedosUI.getRefId({type:"related_list",appId:o,name:"".concat(d,"-").concat(r)});(0,i.useEffect)((function(){window.addEventListener("message",(function(e){"listview.loaded"===e.data.type&&setTimeout((function(){if(SteedosUI.getRef(N)&&SteedosUI.getRef(N).getComponentByName){var e=SteedosUI.getRef(N).getComponentByName("page.listview_".concat(d));I({count:e.props.data.count})}}),300)}))}),[]);return(0,s.jsxs)("div",{className:"slds-page-header slds-page-header_related-list bg-white shadow-none border-none p-0 pb-4",children:[(0,s.jsxs)("div",{className:"slds-page-header__row",children:[(0,s.jsxs)("div",{className:"slds-page-header__col-title",children:[(0,s.jsx)("nav",{role:"navigation","aria-label":"Breadcrumbs",children:(0,s.jsxs)("ol",{className:"slds-breadcrumb slds-list_horizontal",children:[(0,s.jsx)("li",{className:"slds-breadcrumb__item",children:(0,s.jsx)(m(),{href:"/mapp/".concat(o,"/").concat(c),children:(0,s.jsx)("a",{children:v.label})})}),(0,s.jsx)("li",{className:"slds-breadcrumb__item",children:(0,s.jsx)(m(),{href:"/mapp/".concat(o,"/").concat(c,"/view/").concat(l),children:(0,s.jsx)("a",{children:g[v.NAME_FIELD_KEY]})})})]})}),(0,s.jsx)("div",{className:"slds-media",children:(0,s.jsx)("div",{className:"slds-media__body",children:(0,s.jsx)("div",{className:"slds-page-header__name",children:(0,s.jsx)("div",{className:"slds-page-header__name-title",children:(0,s.jsx)("h1",{children:(0,s.jsx)("span",{className:"slds-page-header__title slds-truncate",title:"Contacts (will truncate)",children:null===u||void 0===u||null===(t=u.uiSchema)||void 0===t?void 0:t.label})})})})})})]}),(0,s.jsx)("div",{className:"slds-page-header__col-actions",children:(0,s.jsx)("div",{className:"slds-page-header__controls",children:(0,s.jsx)("div",{className:"slds-page-header__control",children:(0,s.jsx)("ul",{className:"slds-button-group-list",id:"button-group-page-header-actions",children:(0,s.jsx)("li",{children:(0,s.jsxs)(h.v,{as:"div",className:"slds-dropdown-trigger slds-dropdown-trigger_click",children:[(0,s.jsx)("div",{children:(0,s.jsx)(h.v.Button,{className:"border-0",children:(0,s.jsx)("div",{children:(0,s.jsx)("svg",{className:"slds-icon slds-icon-text-default slds-icon_x-small","aria-hidden":"true",children:(0,s.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#threedots_vertical"})})})})}),(0,s.jsx)(b.u,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,s.jsx)(h.v.Items,{className:"absolute right-0 z-10 mt-1 w-56 origin-top-right divide-y divide-gray-100 bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:rounded-[2px]",children:(0,s.jsxs)("div",{className:"",children:[(0,s.jsx)(f.B,{formFactor:y,inMore:!0,foreign_key:r,record_id:l,refId:N,app_id:o,tab_id:d,object_name:d,masterObjectName:c,schema:u}),(0,s.jsx)(h.v.Item,{children:(null===u||void 0===u||null===(n=u.uiSchema)||void 0===n||null===(a=n.permissions)||void 0===a?void 0:a.allowDelete)&&(0,s.jsx)("button",{onClick:function(){var e=SteedosUI.getRef(N).getComponentByName("page.listview_".concat(d));_.isEmpty(e.props.store.toJSON().selectedItems)?e.handleAction({},{actionType:"toast",toast:{items:[{position:"top-right",body:"\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u9879"}]}}):e.handleBulkAction(e.props.store.toJSON().selectedItems,[],{},e.props.bulkActions[0])},className:"slds-dropdown__item group flex w-full items-center border-0 px-2 py-1",children:"\u5220\u9664"})})]})})})]})})})})})})]}),(0,s.jsx)("div",{className:"slds-page-header__row",children:(0,s.jsx)("div",{className:"slds-page-header__col-meta",children:j&&(0,s.jsxs)("p",{className:"slds",children:[j.count," \u9879 \u2022"," ",(0,s.jsx)(p.L,{date:j.dataUpdatedAt})]})})})]})};function v(e){var t=e.schema,n=e.object_name,o=e.foreign_key,r=e.app_id,i=(e.record_id,e.masterObjectName,e.formFactor,(0,l.useRouter)()),c=SteedosUI.getRefId({type:"related_list",appId:r,name:"".concat(n,"-").concat(o)});return(0,s.jsxs)("article",{className:"slds-card slds-card_boundary bg-white shadow-none border-none border-slate-200",children:[t&&(0,s.jsx)(g,(0,a.Z)({refId:c},e)),(0,s.jsx)("div",{className:"border-t",children:t&&(0,s.jsx)(d.k,{id:c,schema:t.amisSchema,router:i,className:"steedos-listview"})})]})}function y(e){e=null!==e?e:(0,r.Z)(new TypeError("Cannot destructure undefined"));var t=(0,l.useRouter)(),n=(0,i.useState)(null),d=n[0],u=n[1],m=t.query,p=m.app_id,f=m.tab_id,_=m.record_id,h=m.related_object_name,b=m.related_field_name,g=(0,i.useState)(),y=g[0],x=g[1];return(0,i.useEffect)((function(){window.innerWidth<768?u("SMALL"):u("LARGE")}),[]),(0,i.useEffect)((function(){f&&d&&(0,c.I3)(p,f,h,b,_,d).then((function(e){x(e)}))}),[f,d]),(0,s.jsx)("div",{className:"p-4",children:y&&(0,s.jsx)(v,(0,o.Z)((0,a.Z)({},y),{app_id:p,record_id:_,formFactor:d}),"".concat(y.object_name,"-").concat(y.foreign_key))})}}},function(e){e.O(0,[774,888,179],(function(){return t=2578,e(e.s=t);var t}));var t=e.O();_N_E=t}]);