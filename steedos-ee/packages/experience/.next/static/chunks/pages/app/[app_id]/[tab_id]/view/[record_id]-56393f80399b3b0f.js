(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[866],{6524:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[app_id]/[tab_id]/view/[record_id]",function(){return s(9823)}])},9597:function(e,a,s){"use strict";s.d(a,{g:function(){return r}});var n=s(5893);function r(){return(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center ",children:(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-8 w-8 text-sky-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}},9823:function(e,a,s){"use strict";s.r(a),s.d(a,{__N_SSP:function(){return b},default:function(){return N}});var n=s(5893),r=(s(5152),s(6859),s(7294)),t=s(1163),c=s(6195),i=s(3796),d=s(9808),l=s(2917),o=s(8985),m=s(6042),u=s(9396),f=s(5125),h=s(1664),p=s.n(h),x=function(e){var a,s=e.schema,r=e.object_name,t=e.foreign_key,c=e.app_id,i=e.record_id,d=e.masterObjectName,l=e.refId,o=e.recordCount,m=e.formFactor;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("header",{className:"slds-media slds-media--center slds-has-flexi-truncate",children:[(0,n.jsx)("div",{"aria-hidden":"true",className:"slds-media__figure stencil slds-avatar slds-avatar_small",children:(0,n.jsx)("div",{className:"extraSmall forceEntityIcon",children:(0,n.jsx)("span",{className:"uiImage slds-icon_container slds-icon-standard-".concat(null===(a=s.uiSchema.icon)||void 0===a?void 0:a.replaceAll("_","-")),children:(0,n.jsx)("svg",{className:"slds-icon slds-page-header__icon","aria-hidden":"true",children:(0,n.jsx)("use",{xlinkHref:"/assets/icons/standard-sprite/svg/symbols.svg#".concat(s.uiSchema.icon)})})})})}),(0,n.jsx)("div",{className:"slds-media__body",children:(0,n.jsx)("h2",{className:"slds-card__header-title",children:(0,n.jsx)(p(),{href:"/app/".concat(c,"/").concat(d,"/").concat(i,"/").concat(r,"/grid?related_field_name=").concat(t),children:(0,n.jsx)("a",{className:"slds-card__header-link baseCard__header-title-container",children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"slds-truncate slds-m-right--xx-small",children:s.uiSchema.label}),(0,n.jsxs)("span",{className:"slds-shrink-none slds-m-right--xx-small",children:["(",o,")"]})]})})})})})]}),(0,n.jsx)("div",{className:"slds-no-flex",children:(0,n.jsx)("div",{className:"actionsContainer",children:(0,n.jsx)("div",{className:"branding-actions slds-button-group slds-m-left--xx-small small oneActionsRibbon forceActionsContainer",children:(0,n.jsx)(f.B,{formFactor:m,foreign_key:t,record_id:i,refId:l,app_id:c,tab_id:r,object_name:r,masterObjectName:d,schema:s})})})})]})};function _(e){var a=e.schema,s=e.object_name,c=e.foreign_key,d=e.app_id,l=(e.record_id,e.masterObjectName,(0,t.useRouter)()),o=SteedosUI.getRefId({type:"related_list",appId:d,name:"".concat(s,"-").concat(c)}),u=(0,r.useState)(0),f=u[0],h=u[1];return(0,r.useEffect)((function(){a&&window.addEventListener("message",(function(e){"listview.loaded"===e.data.type&&a&&setTimeout((function(){var e=SteedosUI.getRefId({type:"related_list",appId:d,name:"".concat(s,"-").concat(c)});if(SteedosUI.getRef(e)&&SteedosUI.getRef(e).getComponentByName){var n=SteedosUI.getRef(e).getComponentByName("page.listview_".concat(a.uiSchema.name));h(n.props.data.count)}}),300)}))}),[a]),(0,n.jsxs)("article",{className:"slds-card slds-card_boundary shadow-none bg-slate-50 border-slate-200",children:[(0,n.jsx)("div",{className:"slds-grid slds-page-header rounded-b-none p-2",children:a&&(0,n.jsx)(x,(0,m.Z)({refId:o,recordCount:f},e))}),(0,n.jsx)("div",{className:f>0?"":"hidden",children:a&&(0,n.jsx)(i.k,{id:o,schema:a.amisSchema,router:l,className:"steedos-related-listview border-t"})})]})}var v=function(e){var a=e.app_id,s=e.record_id,r=e.relateds,t=e.formFactor;return(0,n.jsx)(n.Fragment,{children:null===r||void 0===r?void 0:r.map((function(e){return(0,n.jsx)(_,(0,u.Z)((0,m.Z)({},e),{app_id:a,record_id:s,formFactor:t}),"".concat(e.object_name,"-").concat(e.foreign_key))}))})},j=s(237),g=s(9597);var b=!0;function N(e){var a=e.formFactor,s=(0,t.useRouter)(),m=s.query,u=m.app_id,f=m.tab_id,h=m.record_id,p=(0,r.useState)(!1),x=p[0],_=p[1],b=(0,r.useState)(null),N=b[0],w=b[1],y=(0,r.useState)(null),I=y[0],S=y[1],k=(0,r.useState)(null),F=k[0],C=k[1],E=function(){a&&O(f,h,a)};(0,r.useEffect)((function(){(0,j.Q)(f,h).then((function(e){C(e)}))}),[f,h]),(0,r.useEffect)((function(){E()}),[s]),(0,r.useEffect)((function(){x?a&&R(f,h,a):E()}),[a]);var O=function(e,a,s){if(e&&a){var n=(0,c.ke)(u,e,a,s),r=(0,c.DM)(e,a,{recordId:a,tabId:e,appId:u,formFactor:s});Promise.all([n,r]).then((function(e){S(e[0]);var a=e[1];w(a),_(!1)}))}},R=function(e,a,s){e&&a&&(0,c.KR)(e,{recordId:a,tabId:e,appId:u,formFactor:s}).then((function(e){w(e),_(!0)}))},A=function(){var e=[{label:"\u8be6\u60c5",name:"detail",component:function(){return(0,n.jsx)("div",{className:"",children:(null===N||void 0===N?void 0:N.amisSchema)&&(0,n.jsx)(i.k,{id:SteedosUI.getRefId({type:"detail",appId:u,name:N.uiSchema.name}),schema:(null===N||void 0===N?void 0:N.amisSchema)||{},router:s})})}}];return I&&I.length>0&&e.push({label:"\u76f8\u5173",name:"relateds",component:function(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(v,{app_id:u,record_id:h,relateds:I,formFactor:a})})}}),e},P="SMALL"===a?o.b:l.b;return N?(0,n.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[(0,n.jsx)("div",{className:"region-header bg-slate-50 ",children:N&&(0,n.jsx)(P,{schema:N,formFactor:a,permissions:F})}),(0,n.jsx)("div",{className:"flex flex-1 flex-col region-main overflow-hidden",children:(0,n.jsxs)(d.O.Group,{vertical:!0,children:[(0,n.jsx)(d.O.List,{className:"pl-4 flex space-x-1 border-b bg-slate-50 ",children:A().map((function(e){return(0,n.jsx)(d.O,{className:function(e){return function(){for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return a.filter(Boolean).join(" ")}("px-10 py-2",e.selected?"border-b-2 border-sky-500 text-black":"text-current")},children:e.label},e.name)}))}),(0,n.jsx)(d.O.Panels,{className:"flex-1 p-4 overflow-y-auto ",children:A().map((function(e){return(0,n.jsx)(d.O.Panel,{children:e.component()},e.name)}))})]})})]}):(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(g.g,{})})}}},function(e){e.O(0,[764,499,449,774,888,179],(function(){return a=6524,e(e.s=a);var a}));var a=e.O();_N_E=a}]);