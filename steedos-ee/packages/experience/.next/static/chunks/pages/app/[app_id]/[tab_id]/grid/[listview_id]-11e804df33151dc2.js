(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{3973:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[app_id]/[tab_id]/grid/[listview_id]",function(){return n(7714)}])},8930:function(e,t,n){"use strict";n.d(t,{L:function(){return a}});var s=n(5893),i=n(7294);function a(e){var t=e.date,n=(0,i.useState)(),a=n[0],o=n[1],r=(0,i.useState)(""),l=r[0],d=r[1],c=function(e){return amisRequire("moment")(e).fromNow()};return(0,i.useEffect)((function(){a&&clearInterval(a),d(c(t)),o(setInterval((function(){d(c(t))}),6e4))}),[t]),(0,s.jsx)(s.Fragment,{children:l})}},2767:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var s=n(6042),i=n(5893),a=n(1095),o=n(4413),r=n(1163);function l(e){var t=(0,r.useRouter)(),n=e.button,l=e.data,d=e.className,c=e.scopeClassName,u=e.inMore,p=l.dataComponentId;if("amis_action"===n.type){var f={type:"page",bodyClassName:"p-0",body:[{type:"button",label:n.label,className:"".concat(u?"":"slds-button slds-button_neutral"," ").concat(d||""),onEvent:{click:{actions:JSON.parse(n.amis_actions)}}}],regions:["body"],data:(0,s.Z)({},l)};return(0,i.jsx)(a.k,{id:SteedosUI.getRefId({type:"button",appId:l.app_id,name:n.name}),schema:f,router:t,className:c})}return(0,i.jsx)("button",{onClick:function(){return(0,o.ht)(n,Object.assign({},l,{scope:SteedosUI.getRef(p)}))},className:"slds-button slds-button_neutral ".concat(d||""),children:n.label})}},4413:function(e,t,n){"use strict";n.d(t,{ht:function(){return f},Iv:function(){return c},vU:function(){return u},ud:function(){return p}});var s=n(6486),i=n.n(s),a="__G_L_O_B_A_L__",o=function(e){var t;return"string"===typeof e?1===(t=e.split(".")).length?"#":(t.pop(),t.join(".")):"#"},r=function(e,t){return"#"!==t&&t?"string"===typeof t?s.get(e,t):void console.error("path has to be a string"):e||{}},l=function(e,t){if(e._visible&&(i().startsWith(i().trim(e._visible),"function")?(window.eval("var fun = "+e._visible),e.visible=fun):function(e){var t,n,s;return"string"===typeof e&&(t=/^{{(.+)}}$/,n=/^{{(function.+)}}$/,s=/^{{(.+=>.+)}}$/,!("string"!==typeof e||!e.match(t)||e.match(n)||e.match(s)))}(e._visible)&&(e.visible=function(t){!function(e,t,n,s){var i,l,d,c,u,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(void 0===t&&(t={}),c=o(n),d=r(t,c)||{},"string"!==typeof e)return e;l=e.substring(2,e.length-2),u="\n  var $user=".concat(JSON.stringify(p),";   return ")+l.replace(/\bformData\b/g,JSON.stringify(t).replace(/\bglobal\b/g,a)).replace(/\bglobal\b/g,JSON.stringify(s)).replace(new RegExp("\\b"+a+"\\b","g"),"global").replace(/rootValue/g,JSON.stringify(d));try{Function(u)()}catch(f){return i=f,console.log(i,e,n),e}}(e._visible,t.record,"#",{now:new Date},t.userSession)})),!i().isFunction(e.visible))return e.visible;try{return e.visible(t)}catch(n){}},d=function(e,t){var n=e.permissions.disabled_actions,s=i().sortBy(i().values(e.actions),"sort");return i().has(e,"allow_customActions")&&(s=i().filter(s,(function(t){return i().include(e.allow_customActions,t.name)}))),i().has(e,"exclude_actions")&&(s=i().filter(s,(function(t){return!i().include(e.exclude_actions,t.name)}))),i().each(s,(function(e){t.isMobile&&["record","record_only"].indexOf(e.on)>-1&&"standard_edit"!=e.name&&("record_only"==e.on?e.on="record_only_more":e.on="record_more")})),t.isMobile&&["cms_files","cfs.files.filerecord"].indexOf(e.name)>-1&&i().map(s,(function(e){"standard_edit"===e.name&&(e.on="record_more"),"download"===e.name&&(e.on="record")})),i().filter(s,(function(e){return i().indexOf(n,e.name)<0}))},c=function(e,t){var n=d(e,t);return i().filter(n,(function(e){return"list"==e.on&&l(e,t)}))},u=function(e,t){var n=d(e,t);return i().filter(n,(function(e){return("record"==e.on||"record_only"==e.on)&&l(e,t)}))},p=function(e,t){var n=d(e,t);return i().filter(n,(function(e){return("record_more"==e.on||"record_only_more"==e.on)&&l(e,t)}))},f=function(e,t){if(e.todo)return i().isString(e.todo)&&i().startsWith(i().trim(e.todo),"function")&&(window.eval("var fun = "+e.todo),e.todo=fun),i().isFunction(e.todo)?e.todo.apply({},[t]):void 0}},7714:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return re},default:function(){return le}});var s=n(5893),i=(n(5152),n(6859),n(7294)),a=n(1163),o=n(6195),r=n(1095),l=n(4192),d=n(9946),c=n(6723),u=n(3855);function p(e,t){let[n,s]=(0,i.useState)(e),a=(0,u.E)(e);return(0,c.e)((()=>s(a.current)),[a,s,...t]),n}var f=n(3784),v=n(2351),m=n(2984),h=n(9362),b=n(1363),g=n(1497),x=n(4103),_=n(4575),y=n(6567),S=n(4157),R=n(292),w=n(6045);function N(e={},t=null,n=[]){for(let[s,i]of Object.entries(e))I(n,j(t,s),i);return n}function j(e,t){return e?e+"["+t+"]":t}function I(e,t,n){if(Array.isArray(n))for(let[s,i]of n.entries())I(e,j(t,s.toString()),i);else n instanceof Date?e.push([t,n.toISOString()]):"boolean"==typeof n?e.push([t,n?"1":"0"]):"string"==typeof n?e.push([t,n]):"number"==typeof n?e.push([t,`${n}`]):null==n?e.push([t,""]):N(n,t,e)}var O,C,k=n(5466),E=n(3781),L=((C=L||{})[C.Open=0]="Open",C[C.Closed=1]="Closed",C),T=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(T||{}),U=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(U||{}),P=((O=P||{})[O.OpenListbox=0]="OpenListbox",O[O.CloseListbox=1]="CloseListbox",O[O.SetDisabled=2]="SetDisabled",O[O.SetOrientation=3]="SetOrientation",O[O.GoToOption=4]="GoToOption",O[O.Search=5]="Search",O[O.ClearSearch=6]="ClearSearch",O[O.RegisterOption=7]="RegisterOption",O[O.UnregisterOption=8]="UnregisterOption",O);function F(e,t=(e=>e)){let n=null!==e.activeOptionIndex?e.options[e.activeOptionIndex]:null,s=(0,_.z2)(t(e.options.slice()),(e=>e.dataRef.current.domRef.current)),i=n?s.indexOf(n):null;return-1===i&&(i=null),{options:s,activeOptionIndex:i}}let A={1:e=>e.disabled||1===e.listboxState?e:{...e,activeOptionIndex:null,listboxState:1},0(e){if(e.disabled||0===e.listboxState)return e;let t=e.activeOptionIndex,{value:n,mode:s,compare:i}=e.propsRef.current,a=e.options.findIndex((e=>{let t=e.dataRef.current.value;return(0,m.E)(s,{1:()=>n.some((e=>i(e,t))),0:()=>i(n,t)})}));return-1!==a&&(t=a),{...e,listboxState:0,activeOptionIndex:t}},2:(e,t)=>e.disabled===t.disabled?e:{...e,disabled:t.disabled},3:(e,t)=>e.orientation===t.orientation?e:{...e,orientation:t.orientation},4(e,t){var n;if(e.disabled||1===e.listboxState)return e;let s=F(e),i=(0,g.d)(t,{resolveItems:()=>s.options,resolveActiveIndex:()=>s.activeOptionIndex,resolveId:e=>e.id,resolveDisabled:e=>e.dataRef.current.disabled});return{...e,...s,searchQuery:"",activeOptionIndex:i,activationTrigger:null!=(n=t.trigger)?n:1}},5:(e,t)=>{if(e.disabled||1===e.listboxState)return e;let n=""!==e.searchQuery?0:1,s=e.searchQuery+t.value.toLowerCase(),i=(null!==e.activeOptionIndex?e.options.slice(e.activeOptionIndex+n).concat(e.options.slice(0,e.activeOptionIndex+n)):e.options).find((e=>{var t;return!e.dataRef.current.disabled&&(null==(t=e.dataRef.current.textValue)?void 0:t.startsWith(s))})),a=i?e.options.indexOf(i):-1;return-1===a||a===e.activeOptionIndex?{...e,searchQuery:s}:{...e,searchQuery:s,activeOptionIndex:a,activationTrigger:1}},6:e=>e.disabled||1===e.listboxState||""===e.searchQuery?e:{...e,searchQuery:""},7:(e,t)=>{let n={id:t.id,dataRef:t.dataRef},s=F(e,(e=>[...e,n]));if(null===e.activeOptionIndex){let{value:i,mode:a,compare:o}=e.propsRef.current,r=t.dataRef.current.value;(0,m.E)(a,{1:()=>i.some((e=>o(e,r))),0:()=>o(i,r)})&&(s.activeOptionIndex=s.options.indexOf(n))}return{...e,...s}},8:(e,t)=>{let n=F(e,(e=>{let n=e.findIndex((e=>e.id===t.id));return-1!==n&&e.splice(n,1),e}));return{...e,...n,activationTrigger:1}}},D=(0,i.createContext)(null);function M(e){let t=(0,i.useContext)(D);if(null===t){let t=new Error(`<${e} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,M),t}return t}function z(e,t){return(0,m.E)(t.type,A,e,t)}D.displayName="ListboxContext";let B=i.Fragment,V=(0,v.yV)((function(e,t){let{value:n,name:s,onChange:a,disabled:o=!1,horizontal:r=!1,multiple:l=!1,...d}=e;const u=r?"horizontal":"vertical";let p=(0,f.T)(t),h=(0,i.useReducer)(z,{listboxState:1,propsRef:{current:{value:n,onChange:a,mode:l?1:0,compare:(0,E.z)(((e,t)=>e===t))}},labelRef:(0,i.createRef)(),buttonRef:(0,i.createRef)(),optionsRef:(0,i.createRef)(),disabled:o,orientation:u,options:[],searchQuery:"",activeOptionIndex:null,activationTrigger:1}),[{listboxState:b,propsRef:g,optionsRef:x,buttonRef:S},j]=h;g.current.value=n,g.current.mode=l?1:0,(0,c.e)((()=>{g.current.onChange=e=>(0,m.E)(g.current.mode,{0:()=>a(e),1(){let t=g.current.value.slice(),n=t.indexOf(e);return-1===n?t.push(e):t.splice(n,1),a(t)}})}),[a,g]),(0,c.e)((()=>j({type:2,disabled:o})),[o]),(0,c.e)((()=>j({type:3,orientation:u})),[u]),(0,R.O)([S,x],((e,t)=>{var n;j({type:1}),(0,_.sP)(t,_.tJ.Loose)||(e.preventDefault(),null==(n=S.current)||n.focus())}),0===b);let I=(0,i.useMemo)((()=>({open:0===b,disabled:o})),[b,o]),O={ref:p};return i.createElement(D.Provider,{value:h},i.createElement(y.up,{value:(0,m.E)(b,{0:y.ZM.Open,1:y.ZM.Closed})},null!=s&&null!=n&&N({[s]:n}).map((([e,t])=>i.createElement(w._,{features:w.A.Hidden,...(0,v.oA)({key:e,as:"input",type:"hidden",hidden:!0,readOnly:!0,name:e,value:t})}))),(0,v.sY)({ourProps:O,theirProps:d,slot:I,defaultTag:B,name:"Listbox"})))})),$=(0,v.yV)((function(e,t){var n;let[s,a]=M("Listbox.Button"),o=(0,f.T)(s.buttonRef,t),r=`headlessui-listbox-button-${(0,d.M)()}`,c=(0,l.G)(),u=(0,E.z)((e=>{switch(e.key){case b.R.Space:case b.R.Enter:case b.R.ArrowDown:e.preventDefault(),a({type:0}),c.nextFrame((()=>{s.propsRef.current.value||a({type:4,focus:g.T.First})}));break;case b.R.ArrowUp:e.preventDefault(),a({type:0}),c.nextFrame((()=>{s.propsRef.current.value||a({type:4,focus:g.T.Last})}))}})),m=(0,E.z)((e=>{if(e.key===b.R.Space)e.preventDefault()})),h=(0,E.z)((e=>{if((0,x.P)(e.currentTarget))return e.preventDefault();0===s.listboxState?(a({type:1}),c.nextFrame((()=>{var e;return null==(e=s.buttonRef.current)?void 0:e.focus({preventScroll:!0})}))):(e.preventDefault(),a({type:0}))})),_=p((()=>{if(s.labelRef.current)return[s.labelRef.current.id,r].join(" ")}),[s.labelRef.current,r]),y=(0,i.useMemo)((()=>({open:0===s.listboxState,disabled:s.disabled})),[s]),R=e,w={ref:o,id:r,type:(0,S.f)(e,s.buttonRef),"aria-haspopup":!0,"aria-controls":null==(n=s.optionsRef.current)?void 0:n.id,"aria-expanded":s.disabled?void 0:0===s.listboxState,"aria-labelledby":_,disabled:s.disabled,onKeyDown:u,onKeyUp:m,onClick:h};return(0,v.sY)({ourProps:w,theirProps:R,slot:y,defaultTag:"button",name:"Listbox.Button"})})),H=(0,v.yV)((function(e,t){let[n]=M("Listbox.Label"),s=`headlessui-listbox-label-${(0,d.M)()}`,a=(0,f.T)(n.labelRef,t),o=(0,E.z)((()=>{var e;return null==(e=n.buttonRef.current)?void 0:e.focus({preventScroll:!0})})),r=(0,i.useMemo)((()=>({open:0===n.listboxState,disabled:n.disabled})),[n]);return(0,v.sY)({ourProps:{ref:a,id:s,onClick:o},theirProps:e,slot:r,defaultTag:"label",name:"Listbox.Label"})})),Q=v.AN.RenderStrategy|v.AN.Static,J=(0,v.yV)((function(e,t){var n;let[s,a]=M("Listbox.Options"),o=(0,f.T)(s.optionsRef,t),r=`headlessui-listbox-options-${(0,d.M)()}`,c=(0,l.G)(),u=(0,l.G)(),x=(0,y.oJ)(),_=null!==x?x===y.ZM.Open:0===s.listboxState;(0,i.useEffect)((()=>{var e;let t=s.optionsRef.current;!t||0===s.listboxState&&t!==(null==(e=(0,k.r)(t))?void 0:e.activeElement)&&t.focus({preventScroll:!0})}),[s.listboxState,s.optionsRef]);let S=(0,E.z)((e=>{switch(u.dispose(),e.key){case b.R.Space:if(""!==s.searchQuery)return e.preventDefault(),e.stopPropagation(),a({type:5,value:e.key});case b.R.Enter:if(e.preventDefault(),e.stopPropagation(),null!==s.activeOptionIndex){let{dataRef:e}=s.options[s.activeOptionIndex];s.propsRef.current.onChange(e.current.value)}0===s.propsRef.current.mode&&(a({type:1}),(0,h.k)().nextFrame((()=>{var e;return null==(e=s.buttonRef.current)?void 0:e.focus({preventScroll:!0})})));break;case(0,m.E)(s.orientation,{vertical:b.R.ArrowDown,horizontal:b.R.ArrowRight}):return e.preventDefault(),e.stopPropagation(),a({type:4,focus:g.T.Next});case(0,m.E)(s.orientation,{vertical:b.R.ArrowUp,horizontal:b.R.ArrowLeft}):return e.preventDefault(),e.stopPropagation(),a({type:4,focus:g.T.Previous});case b.R.Home:case b.R.PageUp:return e.preventDefault(),e.stopPropagation(),a({type:4,focus:g.T.First});case b.R.End:case b.R.PageDown:return e.preventDefault(),e.stopPropagation(),a({type:4,focus:g.T.Last});case b.R.Escape:return e.preventDefault(),e.stopPropagation(),a({type:1}),c.nextFrame((()=>{var e;return null==(e=s.buttonRef.current)?void 0:e.focus({preventScroll:!0})}));case b.R.Tab:e.preventDefault(),e.stopPropagation();break;default:1===e.key.length&&(a({type:5,value:e.key}),u.setTimeout((()=>a({type:6})),350))}})),R=p((()=>{var e,t,n;return null!=(n=null==(e=s.labelRef.current)?void 0:e.id)?n:null==(t=s.buttonRef.current)?void 0:t.id}),[s.labelRef.current,s.buttonRef.current]),w=(0,i.useMemo)((()=>({open:0===s.listboxState})),[s]),N=e,j={"aria-activedescendant":null===s.activeOptionIndex||null==(n=s.options[s.activeOptionIndex])?void 0:n.id,"aria-multiselectable":1===s.propsRef.current.mode||void 0,"aria-labelledby":R,"aria-orientation":s.orientation,id:r,onKeyDown:S,role:"listbox",tabIndex:0,ref:o};return(0,v.sY)({ourProps:j,theirProps:N,slot:w,defaultTag:"ul",features:Q,visible:_,name:"Listbox.Options"})})),G=(0,v.yV)((function(e,t){let{disabled:n=!1,value:s,...a}=e,[o,r]=M("Listbox.Option"),l=`headlessui-listbox-option-${(0,d.M)()}`,u=null!==o.activeOptionIndex&&o.options[o.activeOptionIndex].id===l,{value:p,compare:b}=o.propsRef.current,x=(0,m.E)(o.propsRef.current.mode,{1:()=>p.some((e=>b(e,s))),0:()=>b(p,s)}),_=(0,i.useRef)(null),y=(0,f.T)(t,_);(0,c.e)((()=>{if(0!==o.listboxState||!u||0===o.activationTrigger)return;let e=(0,h.k)();return e.requestAnimationFrame((()=>{var e,t;null==(t=null==(e=_.current)?void 0:e.scrollIntoView)||t.call(e,{block:"nearest"})})),e.dispose}),[_,u,o.listboxState,o.activationTrigger,o.activeOptionIndex]);let S=(0,i.useRef)({disabled:n,value:s,domRef:_});(0,c.e)((()=>{S.current.disabled=n}),[S,n]),(0,c.e)((()=>{S.current.value=s}),[S,s]),(0,c.e)((()=>{var e,t;S.current.textValue=null==(t=null==(e=_.current)?void 0:e.textContent)?void 0:t.toLowerCase()}),[S,_]);let R=(0,E.z)((()=>o.propsRef.current.onChange(s)));(0,c.e)((()=>(r({type:7,id:l,dataRef:S}),()=>r({type:8,id:l}))),[S,l]);let w=(0,E.z)((e=>{if(n)return e.preventDefault();R(),0===o.propsRef.current.mode&&(r({type:1}),(0,h.k)().nextFrame((()=>{var e;return null==(e=o.buttonRef.current)?void 0:e.focus({preventScroll:!0})})))})),N=(0,E.z)((()=>{if(n)return r({type:4,focus:g.T.Nothing});r({type:4,focus:g.T.Specific,id:l})})),j=(0,E.z)((()=>{n||u||r({type:4,focus:g.T.Specific,id:l,trigger:0})})),I=(0,E.z)((()=>{n||!u||r({type:4,focus:g.T.Nothing})})),O=(0,i.useMemo)((()=>({active:u,selected:x,disabled:n})),[u,x,n]);return(0,v.sY)({ourProps:{id:l,ref:y,role:"option",tabIndex:!0===n?void 0:-1,"aria-disabled":!0===n||void 0,"aria-selected":!0===x||void 0,disabled:void 0,onClick:w,onFocus:N,onPointerMove:j,onMouseMove:j,onPointerLeave:I,onMouseLeave:I},theirProps:a,slot:O,defaultTag:"li",name:"Listbox.Option"})})),Y=Object.assign(V,{Button:$,Label:H,Options:J,Option:G});var W=n(8390);var Z=i.forwardRef((function(e,t){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:t},e),i.createElement("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"}))}));var q=i.forwardRef((function(e,t){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:t},e),i.createElement("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"}))})),K=n(6486),X=n.n(K),ee=n(4413),te=n(2767),ne=n(7733);function se(e){var t,n,o,r,l=e.app_id,d=e.tab_id,c=e.schema,u=(0,i.useState)(null),p=u[0],f=u[1],v=(0,a.useRouter)();(0,i.useEffect)((function(){c&&c.uiSchema&&f((0,ee.Iv)(c.uiSchema,{app_id:l,tab_id:d,router:v}))}),[c]);return(0,s.jsx)(s.Fragment,{children:(null===c||void 0===c?void 0:c.uiSchema)&&(0,s.jsxs)(s.Fragment,{children:[(null===c||void 0===c||null===(t=c.uiSchema)||void 0===t||null===(n=t.permissions)||void 0===n?void 0:n.allowCreate)&&(0,s.jsx)("button",{onClick:function(){var e,t=SteedosUI.getRefId({type:"listview",appId:l,name:null===c||void 0===c||null===(e=c.uiSchema)||void 0===e?void 0:e.name}),n=ne.Z.listView.newRecordMode;SteedosUI.Object.newRecord({onSubmitted:function(){SteedosUI.getRef(t).getComponentByName("page.listview_".concat(c.uiSchema.name)).handleAction({},{actionType:"reload"})},onCancel:function(){SteedosUI.getRef(t).getComponentByName("page.listview_".concat(c.uiSchema.name)).handleAction({},{actionType:"reload"})},appId:l,name:SteedosUI.getRefId({type:"".concat(n,"-form")}),title:"\u65b0\u5efa ".concat(c.uiSchema.label),objectName:c.uiSchema.name,recordId:"new",type:n,options:{},router:v})},className:"slds-button slds-button_brand",children:"\u65b0\u5efa"}),null===p||void 0===p?void 0:p.map((function(e){return(0,s.jsx)(te.z,{button:e,data:{app_id:l,tab_id:d,object_name:c.uiSchema.name,dataComponentId:SteedosUI.getRefId({type:"listview",appId:l,name:c.uiSchema.name})},scopeClassName:"inline-block"},e.name)})),(null===c||void 0===c||null===(o=c.uiSchema)||void 0===o||null===(r=o.permissions)||void 0===r?void 0:r.allowDelete)&&(0,s.jsx)("button",{onClick:function(){var e,t=SteedosUI.getRefId({type:"listview",appId:l,name:null===c||void 0===c||null===(e=c.uiSchema)||void 0===e?void 0:e.name}),n=SteedosUI.getRef(t).getComponentByName("page.listview_".concat(c.uiSchema.name));X().isEmpty(n.props.store.toJSON().selectedItems)?n.handleAction({},{actionType:"toast",toast:{items:[{position:"top-right",body:"\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u9879"}]}}):(console.log("handleBulkAction",n.props.bulkActions[0]),n.handleBulkAction(n.props.store.toJSON().selectedItems,[],{},n.props.bulkActions[0]))},className:"slds-button slds-button_neutral",children:"\u5220\u9664"})]})})}var ie=n(8930);function ae(e){var t=e.schema,n=e.listViewId,l=e.appId,d=e.onClose,c=(0,i.useState)((0,K.map)((0,K.filter)((0,K.values)(t.uiSchema.fields),(function(e){return e.searchable})),"name")),u=c[0],p=c[1],f=(0,i.useState)(),v=f[0],m=f[1],h=(0,a.useRouter)();(0,i.useEffect)((function(){(0,K.isEmpty)(u)||(0,o.mp)((0,K.sortBy)((0,K.compact)((0,K.map)(u,(function(e){return t.uiSchema.fields[e]}))),"sort_no")).then((function(e){m(e)}))}),[u]);return(0,s.jsx)("div",{className:"slds-panel slds-grid slds-grid_vertical slds-nowrap slds-panel_filters m-0 border-none shadow-none",children:(0,s.jsxs)("div",{className:"slds-filters",children:[(0,s.jsxs)("div",{className:"slds-filters__header slds-grid slds-has-divider_bottom-space p-0 text-lg",children:[(0,s.jsx)("h2",{className:"slds-align-middle slds-text-heading_small",children:"\u67e5\u8be2"}),(0,s.jsxs)("button",{className:"slds-button slds-button_icon slds-button_icon-bare slds-button_icon-small slds-col_bump-left",title:"\u5173\u95ed\u67e5\u8be2",type:"button",onClick:d,children:[(0,s.jsx)("svg",{"aria-hidden":"true",className:"slds-button__icon",viewBox:"0 0 52 52",children:(0,s.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#close"})}),(0,s.jsx)("span",{className:"slds-assistive-text",children:"\u5173\u95ed"})]})]}),(0,s.jsx)("div",{className:"slds-filters__body p-0",children:v&&(0,s.jsx)(r.k,{id:SteedosUI.getRefId({type:"fieldsSearch",appId:l,name:t.uiSchema.name}),schema:v,router:h})}),(0,s.jsxs)("div",{className:"slds-filters__footer slds-grid slds-shrink-none flex justify-between p-0",children:[(0,s.jsx)("div",{}),(0,s.jsxs)("div",{className:"space-x-1",children:[(0,s.jsx)("button",{className:"slds-button_reset slds-text-link slds-col_bump-left",type:"button",onClick:function(){return SteedosUI.Field.showFieldsTransfer(t.uiSchema.name,{fields:u},(function(e){p(e.fields)}),(function(){}))},children:"\u8bbe\u7f6e\u67e5\u8be2\u5b57\u6bb5"}),(0,s.jsxs)("button",{className:"slds-button slds-button_neutral",type:"button",onClick:function(e){var s=SteedosUI.getRef(SteedosUI.getRefId({type:"fieldsSearch",appId:l,name:t.uiSchema.name})).getComponentByName("page.form").getValues();SteedosUI.getRef(n).getComponentByName("page.listview_".concat(t.uiSchema.name)).handleFilterSubmit(s)},children:[(0,s.jsx)("svg",{className:"slds-button__icon slds-button__icon_left","aria-hidden":"true",children:(0,s.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#search"})}),"\u786e\u5b9a"]})]})]})]})})}function oe(e){var t,n,o,r,l,d=e.schema,c=e.onListviewChange,u=(0,i.useState)(!1),p=u[0],f=u[1],v=(0,i.useState)(),m=v[0],h=v[1],b=(0,i.useState)(),g=b[0],x=b[1],_=(0,a.useRouter)(),y=_.query,S=y.app_id,R=y.tab_id,w=y.listview_id,N=d.uiSchema.list_views[w],j=SteedosUI.getRefId({type:"listview",appId:S,name:null===d||void 0===d||null===(t=d.uiSchema)||void 0===t?void 0:t.name});(0,i.useEffect)((function(){d&&window.addEventListener("message",(function(e){"listview.loaded"===e.data.type&&d&&setTimeout((function(){if(SteedosUI.getRef(j)&&SteedosUI.getRef(j).getComponentByName){var e=SteedosUI.getRef(j).getComponentByName("page.listview_".concat(d.uiSchema.name));h({count:e.props.data.count,dataUpdatedAt:e.props.dataUpdatedAt})}}),300)}))}),[d]);var I=function(e){SteedosUI.getRef(j).getComponentByName("page.listview_".concat(d.uiSchema.name)).handleAction({},{actionType:"reload"})};(0,i.useEffect)((function(){!(0,K.isEmpty)(w)&&(0,K.isFunction)(c)&&(x(null),c(N))}),[w]);return(0,s.jsxs)("div",{className:"slds-page-header bg-white p-0 pb-4",children:[(0,s.jsxs)("div",{className:"slds-page-header__row",children:[(0,s.jsx)("div",{className:"slds-page-header__col-title",children:(0,s.jsxs)("div",{className:"slds-media",children:[(0,s.jsx)("div",{className:"slds-media__figure",children:(0,s.jsx)("span",{className:"slds-icon_container slds-icon-standard-opportunity",children:(0,s.jsx)("svg",{className:"slds-icon slds-page-header__icon","aria-hidden":"true",children:(0,s.jsx)("use",{xlinkHref:"/assets/icons/standard-sprite/svg/symbols.svg#".concat(d.uiSchema.icon)})})})}),(0,s.jsx)("div",{className:"slds-media__body",children:(0,s.jsx)("div",{className:"slds-page-header__name",children:(0,s.jsx)("div",{className:"slds-page-header__name-title",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:null===d||void 0===d||null===(n=d.uiSchema)||void 0===n?void 0:n.label}),(0,s.jsx)(Y,{value:N,onChange:function(e){_.push("/app/".concat(S,"/").concat(R,"/grid/").concat(e.name))},children:(0,s.jsxs)("div",{className:"relative w-[1/2]",children:[(0,s.jsxs)(Y.Button,{className:"relative w-full cursor-default pr-10 text-left focus:outline-none focus-visible:border-indigo-500 focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 focus-visible:ring-offset-2 focus-visible:ring-offset-orange-300 sm:text-sm",children:[(0,s.jsx)("span",{className:"slds-page-header__title slds-truncate",children:(null===N||void 0===N?void 0:N.label)||(null===(r=null===d||void 0===d||null===(o=d.uiSchema)||void 0===o?void 0:o.list_views.all)||void 0===r?void 0:r.label)}),(0,s.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,s.jsx)(Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,s.jsx)(W.u,{as:i.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)(Y.Options,{className:"absolute z-50 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:(0,K.values)(null===d||void 0===d||null===(l=d.uiSchema)||void 0===l?void 0:l.list_views).map((function(e,t){return(0,s.jsxs)(Y.Option,{value:e,className:function(e){var t=e.active;return"relative cursor-default select-none py-2 pl-10 pr-4 ".concat(t?"bg-amber-100 text-amber-900":"text-gray-900")},children:[(0,s.jsx)("span",{className:"block truncate ".concat(((null===N||void 0===N?void 0:N.name)?N.name:"all")===e.name?"font-medium":"font-normal"),children:e.label}),((null===N||void 0===N?void 0:N.name)?N.name:"all")===e.name?(0,s.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-amber-600",children:(0,s.jsx)(q,{className:"h-5 w-5","aria-hidden":"true"})}):null]},t)}))})})]})})]})})})})]})}),(0,s.jsx)("div",{className:"slds-page-header__col-actions",children:(0,s.jsx)("div",{className:"slds-page-header__controls",children:(0,s.jsxs)("div",{className:"slds-page-header__control space-x-1",children:[(0,s.jsx)("button",{onClick:function(){p||f(!0)},className:"slds-button slds-button_neutral",children:"\u67e5\u8be2"}),(0,s.jsx)(se,{app_id:S,tab_id:R,schema:d})]})})})]}),(0,s.jsxs)("div",{className:"slds-page-header__row",children:[(0,s.jsx)("div",{className:"slds-page-header__col-meta",children:m&&(0,s.jsxs)("p",{className:"slds-page-header__meta-text mb-0",children:[m.count," \u9879 \u2022"," ",(0,s.jsx)(ie.L,{date:m.dataUpdatedAt})]})}),(0,s.jsx)("div",{className:"slds-page-header__col-controls",children:(0,s.jsxs)("div",{className:"slds-page-header__controls",children:[(0,s.jsx)("div",{className:"slds-page-header__control",children:(0,s.jsxs)("button",{className:"slds-button slds-button_icon slds-button_icon-border-filled",title:"Refresh List",onClick:I,children:[(0,s.jsx)("svg",{className:"slds-button__icon","aria-hidden":"true",children:(0,s.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#refresh"})}),(0,s.jsx)("span",{className:"slds-assistive-text",children:"Refresh List"})]})}),(0,s.jsx)("div",{className:"slds-page-header__control",children:(0,s.jsx)("ul",{className:"slds-button-group-list mb-0",children:(0,s.jsx)("li",{children:(0,s.jsxs)("button",{className:"slds-button slds-button_icon slds-button_icon-border-filled",onClick:function(){SteedosUI.ListView.showFilter(d.uiSchema.name,{listView:N,data:{filters:SteedosUI.ListView.getVisibleFilter(N,g)},onFilterChange:function(e){SteedosUI.getRef(j).updateProps({data:(0,K.defaultsDeep)({filter:SteedosUI.ListView.getQueryFilter(N,e)},d.amisSchema.data)},(function(){I(),x(e)})),setTimeout((function(){I(),x(e)}),300)}})},children:[(0,s.jsx)("svg",{className:"slds-button__icon","aria-hidden":"true",children:(0,s.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#filterList"})}),(0,s.jsx)("span",{className:"slds-assistive-text",children:"\u8fc7\u6ee4\u5668"}),!(0,K.isEmpty)(g)&&(0,s.jsx)("span",{className:"slds-notification-badge slds-incoming-notification slds-show-notification min-h-[0.5rem] min-w-[0.5rem]"})]})})})})]})})]}),(0,s.jsx)(W.u,{as:i.Fragment,show:p,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)("div",{className:"slds-page-header__row slds-page-header__row_gutters pt-2",children:(0,s.jsx)("div",{className:"slds-page-header__col-details",children:(0,s.jsx)(ae,{schema:d,listViewId:j,onClose:function(){p&&(SteedosUI.getRef(j).getComponentByName("page.listview_".concat(d.uiSchema.name)).handleFilterReset(),f(!1))}})})})})]})}var re=!0;function le(e){var t,n=(0,a.useRouter)(),l=n.query,d=l.app_id,c=l.tab_id,u=(0,i.useState)(),p=u[0],f=u[1],v=(0,i.useState)(null),m=v[0],h=v[1],b=SteedosUI.getRefId({type:"listview",appId:d,name:null===p||void 0===p||null===(t=p.uiSchema)||void 0===t?void 0:t.name});(0,i.useEffect)((function(){window.innerWidth<768?h("SMALL"):h("LARGE")}),[]);var g=function(e){(0,o.$R)(d,c,e,{formFactor:m}).then((function(e){f(e)}))};return(0,i.useEffect)((function(){c&&m&&g(void 0)}),[c,m]),(0,s.jsxs)("div",{className:"slds-card slds-card_boundary slds-grid slds-grid--vertical shadow-none border-none",children:[(0,s.jsx)("div",{className:"slds-page-header--object-home slds-page-header_joined slds-page-header_bleed slds-page-header slds-shrink-none p-0 bg-white",children:m&&(null===p||void 0===p?void 0:p.uiSchema.name)===c&&(0,s.jsx)(oe,{schema:p,onListviewChange:function(e){g(null===e||void 0===e?void 0:e.name)}})}),(0,s.jsx)("div",{className:"border",children:(null===p||void 0===p?void 0:p.amisSchema)&&(null===p||void 0===p?void 0:p.uiSchema.name)===c&&(0,s.jsx)(r.k,{className:"steedos-listview",id:b,schema:(null===p||void 0===p?void 0:p.amisSchema)||{},router:n})})]})}},6045:function(e,t,n){"use strict";n.d(t,{A:function(){return a},_:function(){return o}});var s=n(2351);var i,a=((i=a||{})[i.None=1]="None",i[i.Focusable=2]="Focusable",i[i.Hidden=4]="Hidden",i);let o=(0,s.yV)((function(e,t){let{features:n=1,...i}=e,a={ref:t,"aria-hidden":2===(2&n)||void 0,style:{position:"absolute",width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...4===(4&n)&&2!==(2&n)&&{display:"none"}}};return(0,s.sY)({ourProps:a,theirProps:i,slot:{},defaultTag:"div",name:"Hidden"})}))}},function(e){e.O(0,[499,774,888,179],(function(){return t=3973,e(e.s=t);var t}));var t=e.O();_N_E=t}]);