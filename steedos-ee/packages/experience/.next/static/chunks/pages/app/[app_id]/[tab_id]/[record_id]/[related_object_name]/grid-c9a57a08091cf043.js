(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{5511:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[app_id]/[tab_id]/[record_id]/[related_object_name]/grid",function(){return n(5406)}])},8930:function(e,t,n){"use strict";n.d(t,{L:function(){return o}});var a=n(5893),s=n(7294);function o(e){var t=e.date,n=(0,s.useState)(),o=n[0],i=n[1],r=(0,s.useState)(""),c=r[0],d=r[1],l=function(e){return amisRequire("moment")(e).fromNow()};return(0,s.useEffect)((function(){o&&clearInterval(o),d(l(t)),i(setInterval((function(){d(l(t))}),6e4))}),[t]),(0,a.jsx)(a.Fragment,{children:c})}},2767:function(e,t,n){"use strict";n.d(t,{z:function(){return c}});var a=n(6042),s=n(5893),o=n(3796),i=n(4413),r=n(1163);function c(e){var t=(0,r.useRouter)(),n=e.button,c=e.data,d=e.className,l=e.scopeClassName,u=e.inMore,m=c.dataComponentId;if("amis_action"===n.type){var p={type:"service",bodyClassName:"p-0",body:[{type:"button",label:n.label,className:"".concat(u?"flex w-full items-center border-0 px-2 py-1":"bg-white"," ").concat(d||""),onEvent:{click:{actions:JSON.parse(n.amis_actions)}}}],regions:["body"],data:(0,a.Z)({},c)};return(0,s.jsx)(o.k,{id:SteedosUI.getRefId({type:"button",appId:c.app_id,name:n.name}),schema:p,router:t,className:l})}return(0,s.jsx)("button",{onClick:function(){return(0,i.ht)(n,Object.assign({},c,{scope:SteedosUI.getRef(m)}))},className:"antd-Button antd-Button--default ".concat(d||""),children:n.label})}},5125:function(e,t,n){"use strict";n.d(t,{B:function(){return m}});var a=n(4924),s=n(5893),o=n(4413),i=n(1163),r=n(7294),c=n(2767),d=n(3796),l=n(8282),u=n(7733);function m(e){var t,n,m=e.app_id,p=e.tab_id,f=e.schema,h=e.refId,_=e.foreign_key,b=e.record_id,g=e.object_name,v=e.masterObjectName,x=e.inMore,y=e.formFactor,j=(0,r.useState)(null),N=j[0],w=j[1],S=(0,i.useRouter)();(0,r.useEffect)((function(){f&&f.uiSchema&&w((0,o.Iv)(f.uiSchema,{app_id:m,tab_id:p,router:S}))}),[f]);var I=(0,l.Z0)(),k={type:"page",bodyClassName:"p-0",body:[{type:"form",title:"\u8868\u5355",body:[{type:"input-file",label:"",name:"file",id:"u:a58d02614e04",btnLabel:"\u4e0a\u4f20",btnClassName:"m-0",multiple:!1,maxLength:10,submitType:"asUpload",uploadType:"fileReceptor",proxy:!1,drag:!1,autoUpload:!0,useChunk:!1,joinValues:!1,extractValue:!1,valueField:"version_id",receiver:{url:"${context.rootUrl}/s3",headers:{Authorization:"Bearer ${context.tenantId},${context.authToken}"},method:"post",messages:{},dataType:"form-data",requestAdaptor:"\n                        api.data.append('record_id', '".concat(b,"');\n                        api.data.append('object_name', '").concat(v,"');\n                        api.data.append('space', '").concat(I.spaceId,"');\n                        api.data.append('owner', '").concat(I.userId,"');\n                        api.data.append('owner_name', '").concat(I.name,"');\n                        return api;\n                      ")},onEvent:{success:{weight:0,actions:[{componentId:"u:5f901c0b917b",args:{},actionType:"clear"},{componentId:"",args:{msgType:"success",position:"top-right",closeButton:!0,showIcon:!0,msg:"\u4e0a\u4f20\u6210\u529f"},actionType:"toast"},{componentId:"",args:{},actionType:"custom",script:"\n                                SteedosUI.getRef('".concat(h,"').getComponentByName('page.listview_").concat(g,'\').handleAction({}, { actionType: "reload"})\n                            ')}]}}}],id:"u:5f901c0b917b",wrapWithPanel:!1}],regions:["body"],data:{}};return(0,s.jsx)(s.Fragment,{children:(null===f||void 0===f?void 0:f.uiSchema)&&(0,s.jsxs)(s.Fragment,{children:[(null===f||void 0===f||null===(t=f.uiSchema)||void 0===t||null===(n=t.permissions)||void 0===n?void 0:n.allowCreate)&&(0,s.jsxs)(s.Fragment,{children:["cms_files"!=f.uiSchema.name&&(0,s.jsx)("button",{onClick:function(){if("cms_files"===f.uiSchema.name);else{var e=u.Z.listView.newRecordMode;SteedosUI.Object.newRecord({onSubmitted:function(){SteedosUI.getRef(h).getComponentByName("page.listview_".concat(f.uiSchema.name)).handleAction({},{actionType:"reload"})},onCancel:function(){SteedosUI.getRef(h).getComponentByName("page.listview_".concat(f.uiSchema.name)).handleAction({},{actionType:"reload"})},data:{data:(0,a.Z)({},_,b)},appId:m,name:SteedosUI.getRefId({type:"".concat(e,"-form"),appId:m,name:"".concat(f.uiSchema.name)}),title:"\u65b0\u5efa ".concat(f.uiSchema.label),objectName:f.uiSchema.name,recordId:"new",type:e,formFactor:y,options:"SMALL"===y?{props:{width:"100%",style:{width:"100%"},bodyStyle:{padding:"0px",paddingTop:"0px"}}}:{},router:S})}},className:x?"flex w-full items-center border-0 px-2 py-1":"slds-button slds-button_neutral",children:"\u65b0\u5efa"}),"cms_files"===f.uiSchema.name&&(0,s.jsx)(d.k,{id:SteedosUI.getRefId({type:"button",appId:m,name:"upload"}),schema:k,router:S,className:"inline-block"})]}),null===N||void 0===N?void 0:N.map((function(e){return(0,s.jsx)(c.z,{button:e,inMore:x,data:{app_id:m,tab_id:p,object_name:f.uiSchema.name,dataComponentId:SteedosUI.getRefId({type:"listview",appId:m,name:f.uiSchema.name})},className:x?"flex items-center border-0 px-2 py-1":"",scopeClassName:"inline-block"},e.name)}))]})})}},4413:function(e,t,n){"use strict";n.d(t,{ht:function(){return p},Iv:function(){return l},vU:function(){return u},ud:function(){return m}});var a=n(6486),s=n.n(a),o="__G_L_O_B_A_L__",i=function(e){var t;return"string"===typeof e?1===(t=e.split(".")).length?"#":(t.pop(),t.join(".")):"#"},r=function(e,t){return"#"!==t&&t?"string"===typeof t?a.get(e,t):void console.error("path has to be a string"):e||{}},c=function(e,t){if(e._visible&&(s().startsWith(s().trim(e._visible),"function")?(window.eval("var fun = "+e._visible),e.visible=fun):function(e){var t,n,a;return"string"===typeof e&&(t=/^{{(.+)}}$/,n=/^{{(function.+)}}$/,a=/^{{(.+=>.+)}}$/,!("string"!==typeof e||!e.match(t)||e.match(n)||e.match(a)))}(e._visible)&&(e.visible=function(t){!function(e,t,n,a){var s,c,d,l,u,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(void 0===t&&(t={}),l=i(n),d=r(t,l)||{},"string"!==typeof e)return e;c=e.substring(2,e.length-2),u="\n  var $user=".concat(JSON.stringify(m),";   return ")+c.replace(/\bformData\b/g,JSON.stringify(t).replace(/\bglobal\b/g,o)).replace(/\bglobal\b/g,JSON.stringify(a)).replace(new RegExp("\\b"+o+"\\b","g"),"global").replace(/rootValue/g,JSON.stringify(d));try{Function(u)()}catch(p){return s=p,console.log(s,e,n),e}}(e._visible,t.record,"#",{now:new Date},t.userSession)})),!s().isFunction(e.visible))return e.visible;try{return e.visible(t)}catch(n){}},d=function(e,t){var n=e.permissions.disabled_actions,a=s().sortBy(s().values(e.actions),"sort");return s().has(e,"allow_customActions")&&(a=s().filter(a,(function(t){return s().include(e.allow_customActions,t.name)}))),s().has(e,"exclude_actions")&&(a=s().filter(a,(function(t){return!s().include(e.exclude_actions,t.name)}))),s().each(a,(function(e){t.isMobile&&["record","record_only"].indexOf(e.on)>-1&&"standard_edit"!=e.name&&("record_only"==e.on?e.on="record_only_more":e.on="record_more")})),t.isMobile&&["cms_files","cfs.files.filerecord"].indexOf(e.name)>-1&&s().map(a,(function(e){"standard_edit"===e.name&&(e.on="record_more"),"download"===e.name&&(e.on="record")})),s().filter(a,(function(e){return s().indexOf(n,e.name)<0}))},l=function(e,t){var n=d(e,t);return s().filter(n,(function(e){return"list"==e.on&&c(e,t)}))},u=function(e,t){var n=d(e,t);return s().filter(n,(function(e){return("record"==e.on||"record_only"==e.on)&&c(e,t)}))},m=function(e,t){var n=d(e,t);return s().filter(n,(function(e){return("record_more"==e.on||"record_only_more"==e.on)&&c(e,t)}))},p=function(e,t){if(e.todo)return s().isString(e.todo)&&s().startsWith(s().trim(e.todo),"function")&&(window.eval("var fun = "+e.todo),e.todo=fun),s().isFunction(e.todo)?e.todo.apply({},[t]):void 0}},5406:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var a=n(6042),s=n(9396),o=n(5893),i=n(7294),r=n(6195),c=n(3796),d=n(1163),l=n(1664),u=n.n(l),m=n(8930),p=n(5125),f=n(6486),h=n(471),b=n(1355),g=function(e){var t,n,a,s=e.app_id,r=e.foreign_key,c=e.masterObjectName,d=e.object_name,l=e.record_id,g=e.schema,v=e.record,x=e.masterObjectUISchema,y=e.formFactor,j=(0,i.useState)(),N=j[0],w=j[1],S=(0,i.useState)(),I=S[0],k=S[1],R=SteedosUI.getRefId({type:"related_list",appId:s,name:"".concat(d,"-").concat(r)});(0,i.useEffect)((function(){window.addEventListener("message",(function(e){"listview.loaded"===e.data.type&&setTimeout((function(){if(SteedosUI.getRef(R)&&SteedosUI.getRef(R).getComponentByName){var e=SteedosUI.getRef(R).getComponentByName("page.listview_".concat(d));w({count:e.props.data.count})}}),300)}))}),[]);var C=function(e){SteedosUI.getRef(R).getComponentByName("page.listview_".concat(d)).handleAction({},{actionType:"reload"})},U=g.uiSchema.list_views.all;return(0,o.jsxs)("div",{className:"slds-page-header slds-page-header_related-list bg-white shadow-none border-none p-0 pb-4",children:[(0,o.jsxs)("div",{className:"slds-page-header__row",children:[(0,o.jsxs)("div",{className:"slds-page-header__col-title",children:[(0,o.jsx)("nav",{role:"navigation","aria-label":"Breadcrumbs",children:(0,o.jsxs)("ol",{className:"slds-breadcrumb slds-list_horizontal",children:[(0,o.jsx)("li",{className:"slds-breadcrumb__item",children:(0,o.jsx)(u(),{href:"/app/".concat(s,"/").concat(c),children:(0,o.jsx)("a",{children:x.label})})}),(0,o.jsx)("li",{className:"slds-breadcrumb__item",children:(0,o.jsx)(u(),{href:"/app/".concat(s,"/").concat(c,"/view/").concat(l),children:(0,o.jsx)("a",{children:v[x.NAME_FIELD_KEY]})})})]})}),(0,o.jsx)("div",{className:"slds-media",children:(0,o.jsx)("div",{className:"slds-media__body",children:(0,o.jsx)("div",{className:"slds-page-header__name",children:(0,o.jsx)("div",{className:"slds-page-header__name-title",children:(0,o.jsx)("h1",{children:(0,o.jsx)("span",{className:"slds-page-header__title slds-truncate",title:"Contacts (will truncate)",children:null===g||void 0===g||null===(t=g.uiSchema)||void 0===t?void 0:t.label})})})})})})]}),(0,o.jsx)("div",{className:"slds-page-header__col-actions",children:(0,o.jsx)("div",{className:"slds-page-header__controls",children:(0,o.jsxs)("div",{className:"slds-page-header__control space-x-1",children:[(0,o.jsx)(p.B,{formFactor:y,foreign_key:r,record_id:l,refId:R,app_id:s,tab_id:d,object_name:d,masterObjectName:c,schema:g}),(0,o.jsxs)(h.v,{as:"div",className:"antd-Button antd-Button--default",children:[(0,o.jsx)(h.v.Button,{children:(0,o.jsx)("svg",{focusable:"false","data-key":"down","aria-hidden":"true",className:"slds-button__icon",children:(0,o.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#down"})})}),(0,o.jsx)(b.u,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,o.jsx)(h.v.Items,{className:"absolute right-0 z-10 mt-1 w-56 origin-top-right divide-y divide-gray-100 bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:rounded-[2px]",children:(0,o.jsx)("div",{className:"",children:(0,o.jsx)(h.v.Item,{children:(null===g||void 0===g||null===(n=g.uiSchema)||void 0===n||null===(a=n.permissions)||void 0===a?void 0:a.allowDelete)&&(0,o.jsx)("button",{onClick:function(){var e=SteedosUI.getRef(R).getComponentByName("page.listview_".concat(d));_.isEmpty(e.props.store.toJSON().selectedItems)?e.handleAction({},{actionType:"toast",toast:{items:[{position:"top-right",body:"\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u9879"}]}}):e.handleBulkAction(e.props.store.toJSON().selectedItems,[],{},e.props.bulkActions[0])},className:"slds-dropdown__item group flex w-full items-center border-0 px-2 py-2",children:"\u5220\u9664"})})})})})]})]})})})]}),(0,o.jsxs)("div",{className:"slds-page-header__row",children:[(0,o.jsx)("div",{className:"slds-page-header__col-meta",children:N&&(0,o.jsxs)("p",{className:"slds",children:[N.count," \u9879 \u2022"," ",(0,o.jsx)(m.L,{date:N.dataUpdatedAt})]})}),(0,o.jsx)("div",{className:"slds-page-header__col-controls",children:(0,o.jsxs)("div",{className:"slds-page-header__controls",children:[(0,o.jsx)("div",{className:"slds-page-header__control",children:(0,o.jsxs)("button",{className:"slds-button slds-button_icon slds-button_icon-border-filled",title:"Refresh List",onClick:C,children:[(0,o.jsx)("svg",{className:"slds-button__icon","aria-hidden":"true",children:(0,o.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#refresh"})}),(0,o.jsx)("span",{className:"slds-assistive-text",children:"Refresh List"})]})}),(0,o.jsx)("div",{className:"slds-page-header__control",children:(0,o.jsx)("ul",{className:"slds-button-group-list",id:"button-group-page-header-controls",children:(0,o.jsx)("li",{children:(0,o.jsxs)("button",{className:"slds-button slds-button_icon-border-filled",type:"button",onClick:function(){SteedosUI.ListView.showFilter(g.uiSchema.name,{listView:U,data:{filters:SteedosUI.ListView.getVisibleFilter(U,I)},onFilterChange:function(e){SteedosUI.getRef(R).updateProps({data:(0,f.defaultsDeep)({filter:SteedosUI.ListView.getQueryFilter(U,e)},g.amisSchema.data)},(function(){C(),k(e)})),setTimeout((function(){C(),k(e)}),300)}})},children:[(0,o.jsx)("svg",{className:"slds-button__icon","aria-hidden":"true",children:(0,o.jsx)("use",{xlinkHref:"/assets/icons/utility-sprite/svg/symbols.svg#filterList"})}),(0,o.jsx)("span",{className:"slds-assistive-text",children:"\u8fc7\u6ee4\u5668"}),!(0,f.isEmpty)(I)&&(0,o.jsx)("span",{className:"slds-notification-badge slds-incoming-notification slds-show-notification min-h-[0.5rem] min-w-[0.5rem]"})]})})})})]})})]})]})};function v(e){var t=e.schema,n=e.object_name,s=e.foreign_key,i=e.app_id,r=(e.record_id,e.masterObjectName,e.formFactor,(0,d.useRouter)()),l=SteedosUI.getRefId({type:"related_list",appId:i,name:"".concat(n,"-").concat(s)});return(0,o.jsxs)("article",{className:"slds-card slds-card_boundary bg-white shadow-none border-none border-slate-200",children:[t&&(0,o.jsx)(g,(0,a.Z)({refId:l},e)),(0,o.jsx)("div",{className:"border-t",children:t&&(0,o.jsx)(c.k,{id:l,schema:t.amisSchema,router:r,className:"steedos-listview"})})]})}function x(e){var t=e.formFactor,n=(0,d.useRouter)().query,c=n.app_id,l=n.tab_id,u=n.record_id,m=n.related_object_name,p=n.related_field_name,f=(0,i.useState)(),h=f[0],_=f[1];return(0,i.useEffect)((function(){l&&t&&(0,r.I3)(c,l,m,p,u,t).then((function(e){_(e)}))}),[l,t]),(0,o.jsx)("div",{className:"p-4",children:h&&(0,o.jsx)(v,(0,s.Z)((0,a.Z)({},h),{app_id:c,record_id:u,formFactor:t}),"".concat(h.object_name,"-").concat(h.foreign_key))})}}},function(e){e.O(0,[774,888,179],(function(){return t=5511,e(e.s=t);var t}));var t=e.O();_N_E=t}]);