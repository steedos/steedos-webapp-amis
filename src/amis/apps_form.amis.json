{
  "type": "page",
  "body": [
    {
      "type": "wizard",
      "name": "form_edit_${recordId}",
      "debug": false,
      "title": "",
      "api": {
        "method": "post",
        "url": "${context.rootUrl}/graphql",
        "data": {
          "objectName": "${objectName}",
          "$": "$$",
          "recordId": "${recordId}",
          "modalName": "${modalName}"
        },
        "requestAdaptor": "\n        \n        const formData = api.data.$;\n        for (key in formData){\n            // image、select等字段清空值后保存的空字符串转换为null。\n            if(formData[key] === ''){\n                formData[key] = null;\n            }\n        }\n        const objectName = api.data.objectName;\n        const fieldsName = Object.keys(formData);\n        delete formData.created;\n        delete formData.created_by;\n        delete formData.modified;\n        delete formData.modified_by;\n        delete formData._display;\n        \n        \n        let query = `mutation{record: ${objectName}__insert(doc: {__saveData}){_id}}`;\n        if(formData.recordId){\n            query = `mutation{record: ${objectName}__update(id: \"${formData.recordId}\", doc: {__saveData}){_id}}`;\n        };\n        delete formData._id;\n        let __saveData = JSON.stringify(JSON.stringify(formData));\n    \n        api.data = {query: query.replace('{__saveData}', __saveData)};\n        return api;\n    ",
        "responseData": {
          "recordId": "${record._id}"
        },
        "adaptor": "\n            SteedosUI.getRef(api.body.modalName).close();\n            SteedosUI.router.go({objectName: api.body.objectName, recordId: payload.data.record._id, type: api.body.recordId ? 'edit': 'new'});\n            return payload;\n        "
      },
      "initApi": {
        "method": "post",
        "url": "${context.rootUrl}/graphql",
        "sendOn": "!!this.recordId",
        "cache": 100,
        "adaptor": "\n            var data = payload.data.data[0];\n            if(data){\n                data.tabs = _.pluck(data.tabs, 'name');\n                \n                \n                //初始化接口返回的字段移除字段值为null的字段\n                for (key in data){\n                    if(data[key] === null){\n                        delete data[key];\n                    }\n                }\n            };\n            payload.data = data;\n            delete payload.extensions;\n            return payload;\n        ",
        "data": {
          "query": "{data:apps(filters:[\"_id\", \"=\", \"${recordId}\"]){_id,name,code,icon_slds,visible,description,tabs:tabs__expand{name,label},objects,mobile_objects,is_creator,mobile,sort,url,is_use_ie,is_use_iframe,is_new_window,on_click,auth_name,secret,is_system,from_code_id,instance_state,created,created_by:created_by__expand{_id,name},modified,modified_by:modified_by__expand{_id,name},_display{visible,is_creator,mobile,is_use_ie,is_use_iframe,is_new_window,is_system,instance_state,created,modified}}}"
        }
      },
      "initFetch": true,
      "id": "u:eff484b5c357",
      "steps": [
        {
          "title": "详细信息",
          "body": [
            {
              "name": "name",
              "label": "名称",
              "labelRemark": "",
              "required": true,
              "type": "input-text",
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:9677ac1cc3c5"
            },
            {
              "name": "code",
              "label": "API 名称",
              "required": true,
              "type": "input-text",
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:784ac1e92fbf"
            },
            {
              "name": "icon_slds",
              "label": "图标",
              "required": true,
              "type": "select",
              "joinValues": false,
              "extractValue": true,
              "labelField": "label",
              "valueField": "value",
              "autoComplete": {
                "method": "post",
                "url": "${context.rootUrl}/graphql",
                "data": {
                  "query": "{objects(filters: [\"_id\", \"=\", \"-1\"]){_id}}",
                  "$": "$$",
                  "$term": "$term",
                  "$value": "$icon_slds._id",
                  "rfield": "${object_name}"
                },
                "requestAdaptor": "\n        var filters = '[]';\n        var top = 10;\n        if(api.data.$term){\n            filters = '[\"name\", \"contains\", \"'+ api.data.$term +'\"]';\n        }else if(api.data.$value){\n            filters = '[\"_id\", \"=\", \"'+ api.data.$value +'\"]';\n        }\n        api.data.query = api.data.query.replace(/{__filters}/g, filters).replace('{__top}', top);\n        return api;\n    ",
                "adaptor": "\n        payload.data.options = eval(function anonymous(\n) {\n\n  var options;\n  options = [];\n\n  _.forEach(Creator.resources.sldsIcons.standard, function (svg) {\n    return options.push({\n      value: svg,\n      label: svg,\n      icon: svg\n    });\n  });\n\n  return options;\n\n})(api.data);\n        return payload;\n        "
              },
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:d0724fe17aa7"
            },
            {
              "name": "visible",
              "label": "启用",
              "type": "checkbox",
              "tpl": null,
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:07a8a4c5f875"
            },
            {
              "name": "description",
              "label": "描述",
              "type": "textarea",
              "tpl": "<b><%=data.description%></b>",
              "className": "col-span-2 m-0",
              "labelClassName": "text-left",
              "id": "u:40d99f2da55a"
            },
            {
              "name": "sort",
              "label": "排序",
              "type": "input-number",
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:fc07a5376a46"
            }
          ],
          "id": "u:b5b8d4915890"
        },
        {
          "title": "业务对象",
          "body": [
            {
              "name": "tabs",
              "label": "选项卡",
              "type": "select",
              "joinValues": false,
              "extractValue": true,
              "labelField": "label",
              "valueField": "name",
              "autoComplete": {
                "method": "post",
                "url": "${context.rootUrl}/graphql",
                "data": {
                  "orderBy": "${orderBy}",
                  "orderDir": "${orderDir}",
                  "pageNo": "${page}",
                  "pageSize": "${perPage}",
                  "query": "{options:tabs(filters: {__filters}, top: {__top}){_id label:label value:name},count:tabs__count(filters:{__filters})}",
                  "$term": "$term",
                  "$value": "$tabs.name",
                  "$": "$$",
                  "rfield": "${object_name}"
                },
                "requestAdaptor": "\n        var filters = '[]';\n        var top = 10;\n        if(api.data.$term){\n            filters = '[\"name\", \"contains\", \"'+ api.data.$term +'\"]';\n        }else if(api.data.$value){\n            filters = '[\"_id\", \"=\", \"'+ api.data.$value +'\"]';\n        }\n        api.data.query = api.data.query.replace(/{__filters}/g, filters).replace('{__top}', top);\n        return api;\n    "
              },
              "multiple": true,
              "className": "col-span-2 m-0",
              "labelClassName": "text-left",
              "id": "u:7f35c54cbe1f"
            },
            {
              "name": "objects",
              "label": "桌面主菜单",
              "type": "select",
              "joinValues": false,
              "extractValue": true,
              "labelField": "label",
              "valueField": "value",
              "autoComplete": {
                "method": "post",
                "url": "${context.rootUrl}/graphql",
                "data": {
                  "query": "{objects(filters: [\"_id\", \"=\", \"-1\"]){_id}}",
                  "$": "$$",
                  "$term": "$term",
                  "$value": "$objects._id",
                  "rfield": "${object_name}"
                },
                "requestAdaptor": "\n        var filters = '[]';\n        var top = 10;\n        if(api.data.$term){\n            filters = '[\"name\", \"contains\", \"'+ api.data.$term +'\"]';\n        }else if(api.data.$value){\n            filters = '[\"_id\", \"=\", \"'+ api.data.$value +'\"]';\n        }\n        api.data.query = api.data.query.replace(/{__filters}/g, filters).replace('{__top}', top);\n        return api;\n    ",
                "adaptor": "\n        payload.data.options = eval(function anonymous(\n) {\n\n  return Steedos.getObjectsOptions()\n\n})(api.data);\n        return payload;\n        "
              },
              "multiple": true,
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:4e5047e44905"
            },
            {
              "name": "mobile_objects",
              "label": "手机主菜单",
              "type": "select",
              "joinValues": false,
              "extractValue": true,
              "labelField": "label",
              "valueField": "value",
              "autoComplete": {
                "method": "post",
                "url": "${context.rootUrl}/graphql",
                "data": {
                  "query": "{objects(filters: [\"_id\", \"=\", \"-1\"]){_id}}",
                  "$": "$$",
                  "$term": "$term",
                  "$value": "$mobile_objects._id",
                  "rfield": "${object_name}"
                },
                "requestAdaptor": "\n        var filters = '[]';\n        var top = 10;\n        if(api.data.$term){\n            filters = '[\"name\", \"contains\", \"'+ api.data.$term +'\"]';\n        }else if(api.data.$value){\n            filters = '[\"_id\", \"=\", \"'+ api.data.$value +'\"]';\n        }\n        api.data.query = api.data.query.replace(/{__filters}/g, filters).replace('{__top}', top);\n        return api;\n    ",
                "adaptor": "\n        payload.data.options = eval(function anonymous(\n) {\n\n  return Steedos.getObjectsOptions()\n\n})(api.data);\n        return payload;\n        "
              },
              "multiple": true,
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:cfaeb2f857a8"
            },
            {
              "name": "is_creator",
              "label": "显示在桌面菜单中",
              "type": "checkbox",
              "tpl": null,
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:8dc6d3e8521d"
            },
            {
              "name": "mobile",
              "label": "显示在手机菜单中",
              "type": "checkbox",
              "tpl": null,
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:c9ffb7fd0610"
            }
          ],
          "id": "u:191375a237f1"
        },
        {
          "title": "外接应用",
          "body": [
            {
              "name": "url",
              "label": "外部链接",
              "type": "input-url",
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:d7116a113670"
            },
            {
              "name": "is_use_ie",
              "label": "使用IE打开(需使用Steedos桌面客户端)",
              "type": "checkbox",
              "tpl": null,
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:44fa8ee006c1"
            },
            {
              "name": "is_use_iframe",
              "label": "使用iframe打开",
              "type": "checkbox",
              "tpl": null,
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:ba806048fa36"
            },
            {
              "name": "is_new_window",
              "label": "在新窗口打开",
              "type": "checkbox",
              "tpl": null,
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:150163f04699"
            },
            {
              "name": "on_click",
              "label": "链接脚本",
              "type": "textarea",
              "tpl": "<b><%=data.on_click%></b>",
              "className": "col-span-2 m-0",
              "labelClassName": "text-left",
              "id": "u:0fe6df9cc818"
            },
            {
              "name": "auth_name",
              "label": "验证域名",
              "type": "input-text",
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:b084c94a8219"
            },
            {
              "name": "secret",
              "label": "API 密钥",
              "type": "input-text",
              "className": "m-0",
              "labelClassName": "text-left",
              "id": "u:8a56de0be5bb"
            }
          ],
          "id": "u:17ecc1ec4435"
        }
      ]
    }
  ],
  "data": {
    "objectName": "apps",
    "context": {
      "rootUrl": "http://127.0.0.1:5200",
      "tenantId": "fqAbDyTphuZmWgMpb",
      "userId": "683e09cd-8482-4034-bd29-5a30643e6c0f",
      "authToken": "1175e05b2aa6a8037d5b090c07cb2c2a3089eba8212ee5b6b1d05f010756661e8f2bece7d489b47c2cef7c"
    }
  },
  "bodyClassName": "p-0",
  "name": "page_edit_${recordId}",
  "initApi": null,
  "initFetch": null,
  "id": "u:953fda4052b6",
  "regions": [
    "body"
  ]
}